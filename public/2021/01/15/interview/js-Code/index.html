

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="海霸">
  <meta name="keywords" content="">
  <title>js-手写代码 - 628</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>628 blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="js-手写代码">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-01-15 14:50" pubdate>
        January 15, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      15.5k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      247
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">js-手写代码</h1>
            
            <div class="markdown-body">
              <h2 id="一-JS"><a href="#一-JS" class="headerlink" title="一 JS"></a>一 JS</h2><p>1 手写 new Object.create<br>2 获取JS类型<br>3 instanceOf<br>4 深拷贝<br>5 call/apply/bind<br>6 防抖节流<br>7 JSONP<br>8 sum(2,3) === sum(2)(3)<br>9 图片懒加载<br>10 每隔一秒打印 1,2,3,4</p>
<h3 id="1-new-Object-create"><a href="#1-new-Object-create" class="headerlink" title="1 new/Object.create"></a>1 new/Object.create</h3><p>new 实现的原理:<br>(1) 创建一个新对象<br>(2) 将构造函数的作用域赋给新对象（将新对象的 <strong>proto</strong> 指向构造函数的prototype对象）<br>(3) 为这个新对象添加属性（将构造函数的this通过call/apply指向这个新对象，并执行了构造函数中的方法）<br>(4) 如果构造函数没有返回其他方法，那么 this 指向这个对象，否则 this 指向构造函数中返回的对象</p>
<pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Person</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-built_in">this</span>.name = name;
	<span class="hljs-built_in">this</span>.setName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>)</span>&#123; <span class="hljs-built_in">this</span>.name = name &#125;;
	<span class="hljs-built_in">this</span>.getName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name &#125;;
&#125;
<span class="hljs-comment">// 第一步:创建一个新对象</span>
<span class="hljs-keyword">let</span> p1 = &#123;&#125;;
<span class="hljs-comment">// 第二步:将构造函数的作用域赋给新对象（</span>
<span class="hljs-comment">// 将新对象的 __proto__ 指向构造函数的prototype对象）</span>
p1.__proto__ = Person.prototype;
<span class="hljs-comment">// 第三步:为这个新对象添加属性</span>
<span class="hljs-comment">//（将构造函数的this通过call/apply指向这个新对象，并执行了构造函数中的方法）</span>
Person.call(p1);


<span class="hljs-comment">// 手写一个 new 函数</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myNew</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-comment">// 1、创建一个新的空对象</span>
	<span class="hljs-keyword">let</span> target = &#123;&#125;;
	<span class="hljs-comment">// 获取构造函数</span>
	<span class="hljs-keyword">let</span> [<span class="hljs-title">constructor</span>, ...<span class="hljs-title">args</span>] = [...<span class="hljs-title">arguments</span>]
	// 2、将构造函数的作用域赋值给这个新对象
	<span class="hljs-title">target</span>.<span class="hljs-title">__proto__</span> = <span class="hljs-title">constructor</span>.<span class="hljs-title">prototype</span>;
	<span class="hljs-comment">// 3、执行构造函数，将属性或方法添加到这个空对象上</span>
	<span class="hljs-keyword">let</span> result = <span class="hljs-title">constructor</span>.<span class="hljs-title">apply</span>(<span class="hljs-params">target, args</span>);
	<span class="hljs-comment">// 4、如果构造函数执行的结构返回的是一个对象，那么返回这个对象；</span>
	<span class="hljs-comment">//		如果构造函数返回的不是一个对象，返回创建的新对象</span>
	<span class="hljs-keyword">if</span> (result &amp;&amp; (<span class="hljs-keyword">typeof</span> (result) == <span class="hljs-string">&quot;object&quot;</span> 
		|| <span class="hljs-keyword">typeof</span> (result) == <span class="hljs-string">&quot;function&quot;</span>)) &#123;
		<span class="hljs-keyword">return</span> result;
	&#125;
	<span class="hljs-keyword">return</span> target;
&#125;

<span class="hljs-comment">// 测试用例 ---- start</span>
<span class="hljs-keyword">const</span> person = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>&#123;
	<span class="hljs-built_in">this</span>.name = name;
&#125;
person.prototype.getName = <span class="hljs-function">() =&gt;</span> &#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;
&#125;
person.prototype.setName = <span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> &#123;
	<span class="hljs-built_in">this</span>.name = name;
&#125;

<span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> person(<span class="hljs-string">&#x27;zhangsan&#x27;</span>);
p1.setName(<span class="hljs-string">&#x27;lisi&#x27;</span>);</code></pre>

<pre><code class="hljs javaScript"><span class="hljs-comment">// Object.create方法</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params">proto</span>) </span>&#123;
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">F</span>(<span class="hljs-params"></span>) </span>&#123;&#125;;
	F.prototype = proto;
	F.prototype.constructor = F;
	
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> F();
&#125;

<span class="hljs-comment">//官方版Polyfill</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Object</span>.create !== <span class="hljs-string">&quot;function&quot;</span>) &#123;
	<span class="hljs-built_in">Object</span>.create = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">proto, propertiesObject</span>) </span>&#123;
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> proto !== <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> proto !== <span class="hljs-string">&#x27;function&#x27;</span>) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;Object prototype may only be an Object: &#x27;</span> + proto);
		&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (proto === <span class="hljs-literal">null</span>) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;This browser&#x27;s implementation of Object.create is a shim and doesn&#x27;t support &#x27;null&#x27; as the first argument.&quot;</span>);
		&#125;

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> propertiesObject !== <span class="hljs-string">&#x27;undefined&#x27;</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;This browser&#x27;s implementation of Object.create is a shim and doesn&#x27;t support a second argument.&quot;</span>);

		<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">F</span>(<span class="hljs-params"></span>) </span>&#123;&#125;
		F.prototype = proto;

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> F();
	&#125;;
&#125;</code></pre>

<h3 id="2-获取JS类型"><a href="#2-获取JS类型" class="headerlink" title="2 获取JS类型"></a>2 获取JS类型</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 获取JavaScript类型的函数</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getType</span>(<span class="hljs-params">obj</span>) </span>&#123;
	<span class="hljs-comment">// 因为 typeof null = &#x27;object&#x27;</span>
	<span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span>) &#123;
		<span class="hljs-keyword">return</span> obj + <span class="hljs-string">&#x27;&#x27;</span>;
	&#125;
	<span class="hljs-comment">// 判断是引用类型还是基本类型</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">&#x27;object&#x27;</span>) &#123;
		<span class="hljs-comment">// const objClass = Object.prototype.toString.call(obj);</span>
		<span class="hljs-comment">// let type = objClass.split(&#x27; &#x27;)[1].replace(&#x27;]&#x27;, &#x27;&#x27;);</span>
		<span class="hljs-comment">// return type.toLowerCase();</span>
		<span class="hljs-keyword">const</span> typeStr = <span class="hljs-built_in">Object</span>.prototype.toString.call(obj);
		<span class="hljs-comment">// [object Array]</span>
		<span class="hljs-keyword">return</span> typeStr.substring(<span class="hljs-number">8</span>, typeStr.length - <span class="hljs-number">1</span>).toLowerCase();
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj;
	&#125;
&#125;</code></pre>

<h3 id="3-instanceOf"><a href="#3-instanceOf" class="headerlink" title="3 instanceOf"></a>3 instanceOf</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">instanceOf</span>(<span class="hljs-params">left, right</span>) </span>&#123;
	<span class="hljs-keyword">let</span> proto = left.__proto__; 
	<span class="hljs-keyword">let</span> prototype = right.prototype
	<span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;
		<span class="hljs-keyword">if</span>(proto == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
		<span class="hljs-keyword">if</span>(proto == prototype) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
		proto = proto.__proto__;
	&#125;
&#125;</code></pre>

<h3 id="4-深拷贝-浅拷贝"><a href="#4-深拷贝-浅拷贝" class="headerlink" title="4 深拷贝/浅拷贝"></a>4 深拷贝/浅拷贝</h3><p>深拷贝和浅拷贝是针对复杂数据类型来说的，浅拷贝只拷贝一层，而深拷贝是层层拷贝。</p>
<ul>
<li><strong>深拷贝</strong>：深拷贝复制变量值，对于非基本类型的变量，则递归至基本类型变量后，再复制。 深拷贝后的对象与原来的对象是完全隔离的，互不影响，对一个对象的修改并不会影响另一个对象。</li>
<li><strong>浅拷贝</strong>：浅拷贝是会将对象的每个属性进行依次复制，但是当对象的属性值是引用类型时，实质复制的是其引用，当引用指向的值改变时也会跟着变化。</li>
</ul>
<p>浅拷贝的实现方式：</p>
<ul>
<li>Object.assign()</li>
<li>函数库 lodash 的 lodash.clone 方法</li>
<li>展开运算符…</li>
<li>Array.prototype.concat()</li>
<li>Array.prototype.slice()</li>
</ul>
<pre><code class="hljs javaScript"><span class="hljs-comment">// 浅拷贝实现过程</span>
<span class="hljs-keyword">let</span> obj = &#123;
	name: <span class="hljs-string">&#x27;Yvette&#x27;</span>,
	age: <span class="hljs-number">18</span>,
	hobbies: [<span class="hljs-string">&#x27;reading&#x27;</span>, <span class="hljs-string">&#x27;photography&#x27;</span>]
&#125;
<span class="hljs-comment">// 浅拷贝实现方式一: Object.assign()</span>
<span class="hljs-keyword">let</span> obj2 = <span class="hljs-built_in">Object</span>.assign(&#123;&#125;, obj);

<span class="hljs-comment">// 浅拷贝实现方式二: 函数库lodash的_.clone方法</span>
<span class="hljs-keyword">let</span> lodash = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>);
<span class="hljs-keyword">let</span> obj3 = lodash.clone(obj);

<span class="hljs-comment">// 浅拷贝实现方式三: 展开运算符...</span>
<span class="hljs-keyword">let</span> obj4 = &#123;...obj&#125;;

<span class="hljs-comment">// 浅拷贝实现方式四: Array.prototype.concat()</span>
<span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, &#123; <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;kobe&#x27;</span> &#125;];
<span class="hljs-keyword">let</span> arr2 = arr.concat();  

<span class="hljs-comment">// 浅拷贝实现方式五: Array.prototype.concat()</span>
<span class="hljs-keyword">let</span> arr3 = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, &#123; <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;kobe&#x27;</span> &#125;];
<span class="hljs-keyword">let</span> arr4 = arr3.slice();</code></pre>

<p>可以看出，浅拷贝<strong>只对第一层属性</strong>进行了拷贝，当第一层的属性值是基本数据类型时，新的对象和原对象互不影响，但是如果第一层的属性值是复杂数据类型，那么<em>新对象和原对象的属性值其指向的是同一块内存地址</em>。</p>
<p>深拷贝的实现方式：</p>
<ul>
<li><p>JSON.parse(JSON.stringify(obj))</p>
</li>
<li><p>函数库 lodash 的 lodash.cloneDeep 方法</p>
</li>
<li><p>jQuery.extend()方法</p>
</li>
<li><p>手写递归方法</p>
  <pre><code class="hljs javascript"><span class="hljs-comment">// 方法一: JSON.parse(JSON.stringify(obj))</span>
	<span class="hljs-comment">/*</span>
<span class="hljs-comment">	缺陷：</span>
<span class="hljs-comment">	1、对象属性是函数时，无法拷贝</span>
<span class="hljs-comment">	2、原型链上的属性无法拷贝</span>
<span class="hljs-comment">	3、不能正确处理 Date 了类型的数据</span>
<span class="hljs-comment">	4、不能处理 RegExp</span>
<span class="hljs-comment">	5、会忽略 Symbol 和 undefined</span>
<span class="hljs-comment">	*/</span>

<span class="hljs-comment">// 方法二: 函数库 lodash 的 lodash.cloneDeep 方法</span>
<span class="hljs-keyword">let</span> lodash = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>);
<span class="hljs-keyword">let</span> obj = &#123;
	a: <span class="hljs-number">1</span>,
	b: &#123; <span class="hljs-attr">f</span>: &#123; <span class="hljs-attr">g</span>: <span class="hljs-number">1</span> &#125; &#125;,
	c: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
&#125;;
<span class="hljs-keyword">let</span> obj2 = lodash.cloneDeep(obj);

<span class="hljs-comment">// 方法三: .jQuery.extend()方法</span>
<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jquery&#x27;</span>);
<span class="hljs-keyword">var</span> obj3 = &#123;
	a: <span class="hljs-number">1</span>,
	b: &#123; <span class="hljs-attr">f</span>: &#123; <span class="hljs-attr">g</span>: <span class="hljs-number">1</span> &#125; &#125;,
	c: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
&#125;;
<span class="hljs-keyword">var</span> obj4 = $.extend(<span class="hljs-literal">true</span>, &#123;&#125;, obj3); <span class="hljs-comment">//第一个参数为true,就是深拷贝</span>

<span class="hljs-comment">// 方法四: 实现一个 deepClone 函数</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment">步骤:</span>
<span class="hljs-comment">1、如果是基本数据类型，直接返回</span>
<span class="hljs-comment">2、如果是 RegExp 或者 Date 类型，返回对应类型</span>
<span class="hljs-comment">3、如果是复杂数据类型，递归</span>
<span class="hljs-comment">4、考虑循环引用的问题</span>
<span class="hljs-comment">*/</span>
<span class="hljs-comment">// 深拷贝</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deepClone</span>(<span class="hljs-params">obj, hash = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">&#x27;object&#x27;</span>) &#123;
		<span class="hljs-comment">//如果不是复杂数据类型 或者是 Null ，直接返回</span>
		<span class="hljs-keyword">return</span> obj;
	&#125;
	<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(obj);
	<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(obj);

	<span class="hljs-comment">// 考虑循环引用的问题</span>
	<span class="hljs-keyword">if</span> (hash.has(obj)) &#123;
		<span class="hljs-keyword">return</span> hash.get(obj);
	&#125;
	<span class="hljs-comment">/**</span>
<span class="hljs-comment">	 * 如果obj是数组，那么 obj.constructor 是 [Function: Array]</span>
<span class="hljs-comment">	 * 如果obj是对象，那么 obj.constructor 是 [Function: Object]</span>
<span class="hljs-comment">	 */</span>
	<span class="hljs-keyword">let</span> cloneObj = <span class="hljs-keyword">new</span> obj.constructor();
	hash.set(obj, cloneObj);
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> obj) &#123;
		<span class="hljs-comment">//递归</span>
		<span class="hljs-keyword">if</span> (obj.hasOwnProperty(key)) &#123; <span class="hljs-comment">// 是否是自身的属性</span>
			cloneObj[key] = deepClone(obj[key], hash);
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> cloneObj;
&#125;</code></pre>

  <pre><code class="hljs javaScript"><span class="hljs-comment">// 满分答案</span>
<span class="hljs-comment">// https://github.com/ConardLi/ConardLi.github.io/blob/master/demo/deepClone/src/clone_6.js</span>
<span class="hljs-keyword">const</span> mapTag = <span class="hljs-string">&#x27;[object Map]&#x27;</span>;
<span class="hljs-keyword">const</span> setTag = <span class="hljs-string">&#x27;[object Set]&#x27;</span>;
<span class="hljs-keyword">const</span> arrayTag = <span class="hljs-string">&#x27;[object Array]&#x27;</span>;
<span class="hljs-keyword">const</span> objectTag = <span class="hljs-string">&#x27;[object Object]&#x27;</span>;
<span class="hljs-keyword">const</span> argsTag = <span class="hljs-string">&#x27;[object Arguments]&#x27;</span>;
<span class="hljs-keyword">const</span> boolTag = <span class="hljs-string">&#x27;[object Boolean]&#x27;</span>;
<span class="hljs-keyword">const</span> dateTag = <span class="hljs-string">&#x27;[object Date]&#x27;</span>;
<span class="hljs-keyword">const</span> numberTag = <span class="hljs-string">&#x27;[object Number]&#x27;</span>;
<span class="hljs-keyword">const</span> stringTag = <span class="hljs-string">&#x27;[object String]&#x27;</span>;
<span class="hljs-keyword">const</span> symbolTag = <span class="hljs-string">&#x27;[object Symbol]&#x27;</span>;
<span class="hljs-keyword">const</span> errorTag = <span class="hljs-string">&#x27;[object Error]&#x27;</span>;
<span class="hljs-keyword">const</span> regexpTag = <span class="hljs-string">&#x27;[object RegExp]&#x27;</span>;
<span class="hljs-keyword">const</span> funcTag = <span class="hljs-string">&#x27;[object Function]&#x27;</span>;

<span class="hljs-keyword">const</span> deepTag = [mapTag, setTag, arrayTag, objectTag, argsTag];

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">forEach</span>(<span class="hljs-params">array, iteratee</span>) </span>&#123;
	<span class="hljs-keyword">let</span> index = -<span class="hljs-number">1</span>;
	<span class="hljs-keyword">const</span> length = array.length;
	<span class="hljs-keyword">while</span> (++index &lt; length) &#123;
		iteratee(array[index], index);
	&#125;
	<span class="hljs-keyword">return</span> array;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isObject</span>(<span class="hljs-params">target</span>) </span>&#123;
	<span class="hljs-keyword">const</span> type = <span class="hljs-keyword">typeof</span> target;
	<span class="hljs-keyword">return</span> target !== <span class="hljs-literal">null</span> &amp;&amp; (type === <span class="hljs-string">&#x27;object&#x27;</span> || type === <span class="hljs-string">&#x27;function&#x27;</span>);
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getType</span>(<span class="hljs-params">target</span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(target);
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInit</span>(<span class="hljs-params">target</span>) </span>&#123;
	<span class="hljs-keyword">const</span> Ctor = target.constructor;
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Ctor();
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cloneSymbol</span>(<span class="hljs-params">targe</span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>(<span class="hljs-built_in">Symbol</span>.prototype.valueOf.call(targe));
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cloneReg</span>(<span class="hljs-params">targe</span>) </span>&#123;
	<span class="hljs-keyword">const</span> reFlags = <span class="hljs-regexp">/\w*$/</span>;
	<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">new</span> targe.constructor(targe.source, reFlags.exec(targe));
	result.lastIndex = targe.lastIndex;
	<span class="hljs-keyword">return</span> result;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cloneFunction</span>(<span class="hljs-params">func</span>) </span>&#123;
	<span class="hljs-keyword">const</span> bodyReg = <span class="hljs-regexp">/(?&lt;=&#123;)(.|\n)+(?=&#125;)/m</span>;
	<span class="hljs-keyword">const</span> paramReg = <span class="hljs-regexp">/(?&lt;=\().+(?=\)\s+&#123;)/</span>;
	<span class="hljs-keyword">const</span> funcString = func.toString();
	<span class="hljs-keyword">if</span> (func.prototype) &#123;
		<span class="hljs-keyword">const</span> param = paramReg.exec(funcString);
		<span class="hljs-keyword">const</span> body = bodyReg.exec(funcString);
		<span class="hljs-keyword">if</span> (body) &#123;
				<span class="hljs-keyword">if</span> (param) &#123;
					<span class="hljs-keyword">const</span> paramArr = param[<span class="hljs-number">0</span>].split(<span class="hljs-string">&#x27;,&#x27;</span>);
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(...paramArr, body[<span class="hljs-number">0</span>]);
				&#125; <span class="hljs-keyword">else</span> &#123;
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(body[<span class="hljs-number">0</span>]);
				&#125;
		&#125; <span class="hljs-keyword">else</span> &#123;
				<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
		&#125;
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(funcString);
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cloneOtherType</span>(<span class="hljs-params">targe, type</span>) </span>&#123;
	<span class="hljs-keyword">const</span> Ctor = targe.constructor;
	<span class="hljs-keyword">switch</span> (type) &#123;
		<span class="hljs-keyword">case</span> boolTag:
		<span class="hljs-keyword">case</span> numberTag:
		<span class="hljs-keyword">case</span> stringTag:
		<span class="hljs-keyword">case</span> errorTag:
		<span class="hljs-keyword">case</span> dateTag:
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Ctor(targe);
		<span class="hljs-keyword">case</span> regexpTag:
				<span class="hljs-keyword">return</span> cloneReg(targe);
		<span class="hljs-keyword">case</span> symbolTag:
				<span class="hljs-keyword">return</span> cloneSymbol(targe);
		<span class="hljs-keyword">case</span> funcTag:
				<span class="hljs-keyword">return</span> cloneFunction(targe);
		<span class="hljs-keyword">default</span>:
				<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clone</span>(<span class="hljs-params">target, map = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()</span>) </span>&#123;

	<span class="hljs-comment">// 克隆原始类型</span>
	<span class="hljs-keyword">if</span> (!isObject(target)) &#123;
		<span class="hljs-keyword">return</span> target;
	&#125;

	<span class="hljs-comment">// 初始化</span>
	<span class="hljs-keyword">const</span> type = getType(target);
	<span class="hljs-keyword">let</span> cloneTarget;
	<span class="hljs-keyword">if</span> (deepTag.includes(type)) &#123;
		cloneTarget = getInit(target, type);
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">return</span> cloneOtherType(target, type);
	&#125;

	<span class="hljs-comment">// 防止循环引用</span>
	<span class="hljs-keyword">if</span> (map.get(target)) &#123;
		<span class="hljs-keyword">return</span> map.get(target);
	&#125;
	map.set(target, cloneTarget);

	<span class="hljs-comment">// 克隆set</span>
	<span class="hljs-keyword">if</span> (type === setTag) &#123;
		target.forEach(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
				cloneTarget.add(clone(value, map));
		&#125;);
		<span class="hljs-keyword">return</span> cloneTarget;
	&#125;

	<span class="hljs-comment">// 克隆map</span>
	<span class="hljs-keyword">if</span> (type === mapTag) &#123;
		target.forEach(<span class="hljs-function">(<span class="hljs-params">value, key</span>) =&gt;</span> &#123;
				cloneTarget.set(key, clone(value, map));
		&#125;);
		<span class="hljs-keyword">return</span> cloneTarget;
	&#125;

	<span class="hljs-comment">// 克隆对象和数组</span>
	<span class="hljs-keyword">const</span> keys = type === arrayTag ? <span class="hljs-literal">undefined</span> : <span class="hljs-built_in">Object</span>.keys(target);
	forEach(keys || target, <span class="hljs-function">(<span class="hljs-params">value, key</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">if</span> (keys) &#123;
				key = value;
		&#125;
		cloneTarget[key] = clone(target[key], map);
	&#125;);

	<span class="hljs-keyword">return</span> cloneTarget;
&#125;

<span class="hljs-built_in">module</span>.exports = &#123;
	clone
&#125;;</code></pre>

</li>
</ul>
<h3 id="5-call-apply-bind"><a href="#5-call-apply-bind" class="headerlink" title="5 call/apply/bind"></a>5 call/apply/bind</h3><p>call 和 apply 的功能相同，都是改变 this 指向，并立即执行函数。区别在于传参方式不同：</p>
<ul>
<li>func.call(this, arg1, arg2, …)</li>
<li>func.apply(this, [arg1, arg2, …])</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>如果第一个参数没有传入，那么默认指向 window / global(非严格模式)</li>
<li>传入 call 的第一个参数是 this 指向的对象，根据隐式绑定的规则，我们知道 obj.foo(), foo() 中的 this 指向 obj; 因此我们可以这样调用函数 thisArgs.func(…args)</li>
<li>返回执行结果</li>
</ol>
<pre><code class="hljs javaScript"><span class="hljs-comment">// call</span>
<span class="hljs-built_in">Function</span>.prototype.call2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">let</span> [thisArg, ...args] = [...arguments];
	<span class="hljs-keyword">if</span> (!thisArg) &#123;
		<span class="hljs-comment">// context 为null 或者是 undefined</span>
		thisArg = <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> === <span class="hljs-string">&#x27;undefined&#x27;</span> ? <span class="hljs-built_in">global</span> : <span class="hljs-built_in">window</span>;
	&#125;
	<span class="hljs-comment">// this 就是当前函数 func(func.call)</span>
	thisArg.func = <span class="hljs-built_in">this</span>;
	<span class="hljs-comment">// 执行函数</span>
	<span class="hljs-keyword">let</span> result = thisArg.func(...args);
	<span class="hljs-comment">// 由于thisArg 上原本没有 func，因此执行完后需要删除</span>
	<span class="hljs-keyword">delete</span> thisArg.func;

	<span class="hljs-keyword">return</span> result;
&#125;

<span class="hljs-comment">// 测试用例 --------start</span>
<span class="hljs-comment">// test1</span>
<span class="hljs-keyword">const</span> c = &#123;
	name: <span class="hljs-string">&#x27;c罗&#x27;</span>,
	age: <span class="hljs-string">&#x27;34&#x27;</span>,
	func: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arg1, arg2</span>) </span>&#123;
		<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.name + <span class="hljs-string">&#x27;:&#x27;</span> + <span class="hljs-built_in">this</span>.age + <span class="hljs-string">&#x27;-&#x27;</span> + arg1 + <span class="hljs-string">&#x27;-&#x27;</span> + arg2);
	&#125;
&#125;

<span class="hljs-keyword">const</span> n = &#123;
	name: <span class="hljs-string">&#x27;梅西&#x27;</span>,
	age: <span class="hljs-string">&#x27;32&#x27;</span>,
&#125;
c.func.call2(n, <span class="hljs-string">&#x27;t1&#x27;</span>, <span class="hljs-string">&#x27;t2&#x27;</span>); <span class="hljs-comment">// 梅西:32-t1-t2</span>
c.func(<span class="hljs-string">&#x27;t3&#x27;</span>, <span class="hljs-string">&#x27;t4&#x27;</span>); <span class="hljs-comment">// c罗:34-t3-t4</span>
<span class="hljs-comment">// 测试用例 --------end</span>

<span class="hljs-comment">// apply 与 call 区别就是传参的不同</span>
<span class="hljs-comment">// apply</span>
<span class="hljs-built_in">Function</span>.prototype.apply2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">thisArg, rest</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (!thisArg) &#123;
		<span class="hljs-comment">// context 为null 或者是 undefined</span>
		thisArg = <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> === <span class="hljs-string">&#x27;undefined&#x27;</span> ? <span class="hljs-built_in">global</span> : <span class="hljs-built_in">window</span>;
	&#125;
	<span class="hljs-keyword">let</span> result; <span class="hljs-comment">// 函数执行结果</span>
	thisArg.func = <span class="hljs-built_in">this</span>;
	<span class="hljs-keyword">if</span> (!rest) &#123;
		result = thisArg.func();
	&#125; <span class="hljs-keyword">else</span> &#123;
		result = thisArg.func(...rest);
	&#125;
	<span class="hljs-keyword">delete</span> thisArg.func;
	<span class="hljs-keyword">return</span> result;
&#125;

<span class="hljs-comment">// 测试用例 --------start</span>
<span class="hljs-comment">// test1</span>
<span class="hljs-keyword">const</span> c = &#123;
	name: <span class="hljs-string">&#x27;c罗&#x27;</span>,
	age: <span class="hljs-string">&#x27;34&#x27;</span>,
	func: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arg1, arg2</span>) </span>&#123;
		<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.name + <span class="hljs-string">&#x27;:&#x27;</span> + <span class="hljs-built_in">this</span>.age + <span class="hljs-string">&#x27;-&#x27;</span> + arg1 + <span class="hljs-string">&#x27;-&#x27;</span> + arg2);
	&#125;
&#125;

<span class="hljs-keyword">const</span> n = &#123;
	name: <span class="hljs-string">&#x27;梅西&#x27;</span>,
	age: <span class="hljs-string">&#x27;32&#x27;</span>,
&#125;
c.func.apply(n, [<span class="hljs-string">&#x27;t1&#x27;</span>, <span class="hljs-string">&#x27;t2&#x27;</span>]); <span class="hljs-comment">// 梅西:32-t1-t2</span>
c.func(<span class="hljs-string">&#x27;t3&#x27;</span>, <span class="hljs-string">&#x27;t4&#x27;</span>); <span class="hljs-comment">// c罗:34-t3-t4</span>
<span class="hljs-comment">// 测试用例 --------end</span></code></pre>

<pre><code class="hljs javaScript"><span class="hljs-comment">// bind:</span>
<span class="hljs-built_in">Function</span>.prototype.bind2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">content</span>) </span>&#123;
	<span class="hljs-comment">// 若没问参数类型则从这开始写</span>
	<span class="hljs-keyword">const</span> fn = <span class="hljs-built_in">this</span>;
	<span class="hljs-keyword">const</span> args = [...arguments].slice(<span class="hljs-number">1</span>);
	
	<span class="hljs-keyword">const</span> resFn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
		<span class="hljs-keyword">return</span> fn.apply(<span class="hljs-built_in">this</span> <span class="hljs-keyword">instanceof</span> resFn ?
			<span class="hljs-built_in">this</span> : content, args.concat(...arguments) );
	&#125;
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tmp</span>(<span class="hljs-params"></span>) </span>&#123;&#125;
	tmp.prototype = <span class="hljs-built_in">this</span>.prototype;
	resFn.prototype = <span class="hljs-keyword">new</span> tmp();
	
	<span class="hljs-keyword">return</span> resFn;
&#125;

<span class="hljs-comment">// 测试用例 --------start</span>
<span class="hljs-comment">// test 1</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params">a, b, c</span>) </span>&#123;
  <span class="hljs-keyword">return</span> a + b + c;
&#125;

<span class="hljs-keyword">var</span> _fn = fn.bind2(<span class="hljs-literal">null</span>, <span class="hljs-number">10</span>);
<span class="hljs-built_in">console</span>.log(_fn(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>)); <span class="hljs-comment">// 60</span>

<span class="hljs-comment">// test2</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name, age</span>) </span>&#123;
  <span class="hljs-built_in">this</span>.name = name;
  <span class="hljs-built_in">this</span>.age = age;
&#125;

<span class="hljs-keyword">const</span> _Person = Person.bind(<span class="hljs-literal">null</span>, <span class="hljs-string">&#x27;beike&#x27;</span>);
<span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> _Person(<span class="hljs-number">30</span>);
<span class="hljs-built_in">console</span>.log(p1); <span class="hljs-comment">// Person &#123;name: &quot;hanzichi&quot;, age: 30&#125;</span>

<span class="hljs-comment">// test4</span>
<span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;梅西&#x27;</span>;
<span class="hljs-keyword">var</span> age = <span class="hljs-number">33</span>;
<span class="hljs-keyword">var</span> obj = &#123;
	name: <span class="hljs-string">&#x27;坎特&#x27;</span>,
	age: <span class="hljs-built_in">this</span>.age,
	myFun: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>,to</span>)</span>&#123;
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;name:&#x27;</span> + <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&#x27;, Age:&#x27;</span> + <span class="hljs-built_in">this</span>.age)
	&#125;
&#125;
<span class="hljs-keyword">var</span> db = &#123;
	name: <span class="hljs-string">&#x27;德布劳内&#x27;</span>,
	age: <span class="hljs-number">29</span>
&#125;
<span class="hljs-keyword">var</span> rm = &#123;
	name: <span class="hljs-string">&#x27;里克尔梅&#x27;</span>,
	age: <span class="hljs-number">42</span>
&#125;
obj.myFun(); <span class="hljs-comment">// name:坎特, Age:33</span>
obj.myFun.apply2(rm); <span class="hljs-comment">// name:里克尔梅, Age:42</span>
obj.myFun.call2(db); <span class="hljs-comment">// name:德布劳内, Age:29</span>
obj.myFun.bind2(db)(); <span class="hljs-comment">// name:德布劳内, Age:29</span>
<span class="hljs-comment">// 测试用例 --------end</span></code></pre>

<h3 id="6-防抖-节流"><a href="#6-防抖-节流" class="headerlink" title="6 防抖/节流"></a>6 防抖/节流</h3><p>考点：闭包、防抖、节流</p>
<p>统计按钮一秒点击次数</p>
<pre><code class="hljs javaScript">button.onclick = debounce(<span class="hljs-function">()=&gt;</span>&#123;
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;点击一次&#x27;</span>);
&#125;,<span class="hljs-number">1000</span>);

<span class="hljs-comment">// 统计一秒点击次数</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span>(<span class="hljs-params">fn, time</span>) </span>&#123;
	<span class="hljs-keyword">let</span> number = <span class="hljs-number">0</span> , timer  = <span class="hljs-literal">null</span>
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...arg</span>) </span>&#123; 
		fn.apply(<span class="hljs-built_in">this</span>, arg)
		number++
		<span class="hljs-keyword">if</span> (timer) <span class="hljs-keyword">return</span>
		timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;
			<span class="hljs-built_in">console</span>.log( <span class="hljs-string">&#x27;点击&#x27;</span>+ number + <span class="hljs-string">&#x27;次&#x27;</span> )
			number = <span class="hljs-number">0</span>
			timer = <span class="hljs-literal">null</span>
		&#125;, time)
	&#125;
&#125;

<span class="hljs-comment">//	- 防抖意clk延迟时间。</span>
<span class="hljs-comment">// 防抖</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span>(<span class="hljs-params">fn, time = <span class="hljs-number">500</span></span>) </span>&#123;
	<span class="hljs-keyword">let</span> timeout = <span class="hljs-literal">null</span>;
	<span class="hljs-comment">// 创建一个标记用来存放定时器的返回值</span>
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123; 
		<span class="hljs-built_in">clearTimeout</span>(timeout);
		<span class="hljs-comment">// 每当用户输入的时候把前一个 setTimeout clear 掉</span>
		timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;
			<span class="hljs-comment">// 然后又创建一个新的 setTimeout</span>
			<span class="hljs-comment">// 这样就能保证输入字符后的interval </span>
			<span class="hljs-comment">// 间隔内如果还有字符输入的话，就不会执行 fn 函数	 </span>
			fn.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>)
		&#125;, time)
 	&#125;
 &#125;

<span class="hljs-comment">// - 节流: 高频事件触发，但在 n 秒内只会执行一次(第一次)，所以节流会稀释函数的执行频率。</span>
<span class="hljs-comment">// 节流</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">throttle</span>(<span class="hljs-params">fn, time = <span class="hljs-number">500</span></span>) </span>&#123; 
	<span class="hljs-keyword">let</span> canRun = <span class="hljs-literal">true</span> <span class="hljs-comment">//</span>
	<span class="hljs-comment">// 通过闭包保存一个标记</span>
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
		<span class="hljs-keyword">if</span> (!canRun) <span class="hljs-keyword">return</span>
		<span class="hljs-comment">// 在函数开头判断标记是否为 true，不为 true 则 return</span>
		canRun = <span class="hljs-literal">false</span> <span class="hljs-comment">// 立即设置为 false</span>
		<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;
			fn.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>)
			<span class="hljs-comment">// 最后在 setTimeout 执行完毕后再把标记设置为 true(关键)</span>
			<span class="hljs-comment">// 表示可以执行下一次循环了。</span>
			<span class="hljs-comment">// 当定时器没有执行的时候标记永远是 false，在开头被return</span>
			canRun = <span class="hljs-literal">true</span>
		&#125;, time)
	&#125;
&#125;</code></pre>

<p>防抖的应用场景:</p>
<ul>
<li>搜索框输入查询，如果用户一直在输入中，没有必要不停地调用去请求服务端接口，等用户停止输入的时候，再调用，设置一个合适的时间间隔，有效减轻服务端压力。</li>
<li>表单验证</li>
<li>按钮提交事件。</li>
<li>浏览器窗口缩放，resize事件(如窗口停止改变大小之后重新计算布局)等。</li>
</ul>
<p>节流的应用场景</p>
<ul>
<li>按钮点击事件</li>
<li>拖拽事件</li>
<li>onScoll</li>
<li>计算鼠标移动的距离(mousemove)</li>
</ul>
<h3 id="7-JSONP"><a href="#7-JSONP" class="headerlink" title="7 JSONP"></a>7 JSONP</h3><pre><code class="hljs javaScript"><span class="hljs-keyword">const</span> jsonp = <span class="hljs-function">(<span class="hljs-params">&#123; url, params, callbackName &#125;</span>) =&gt;</span> &#123;
	<span class="hljs-keyword">const</span> generateUrl = <span class="hljs-function">() =&gt;</span> &#123;
		<span class="hljs-keyword">let</span> dataSrc = <span class="hljs-string">&#x27;&#x27;</span>
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> params) &#123;
			<span class="hljs-keyword">if</span> (params.hasOwnProperty(key)) &#123;
				dataSrc += <span class="hljs-string">`<span class="hljs-subst">$&#123;key&#125;</span>=<span class="hljs-subst">$&#123;params[key]&#125;</span>&amp;`</span>
			&#125;
		&#125;
		dataSrc += <span class="hljs-string">`callback=<span class="hljs-subst">$&#123;callbackName&#125;</span>`</span>
		<span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;url&#125;</span>?<span class="hljs-subst">$&#123;dataSrc&#125;</span>`</span>;
	&#125;
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">const</span> scriptEle = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;script&#x27;</span>)
		scriptEle.src = generateUrl();
		<span class="hljs-built_in">document</span>.body.appendChild(scriptEle)
		<span class="hljs-built_in">window</span>[callbackName] = <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;
			resolve(data)
			<span class="hljs-built_in">document</span>.removeChild(scriptEle)
		&#125;
	&#125;)
&#125;</code></pre>

<h3 id="8-sum-2-3-sum-2-3"><a href="#8-sum-2-3-sum-2-3" class="headerlink" title="8 sum(2,3) === sum(2)(3)"></a>8 sum(2,3) === sum(2)(3)</h3><pre><code class="hljs javaScript"><span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>));   <span class="hljs-comment">// Outputs 5</span>
<span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>));  <span class="hljs-comment">// Outputs 5</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">var</span> fir = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">if</span>(<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) &#123;
		re
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sec</span>) </span>&#123;
			<span class="hljs-keyword">return</span> fir + sec;
		&#125;
	&#125;
&#125;</code></pre>

<h3 id="9-图片懒加载"><a href="#9-图片懒加载" class="headerlink" title="9 图片懒加载"></a>9 图片懒加载</h3><pre><code class="hljs javaScript"><span class="hljs-keyword">let</span> imgList = [...document.querySelectorAll(<span class="hljs-string">&#x27;img&#x27;</span>)]
<span class="hljs-keyword">let</span> length = imgList.length

<span class="hljs-comment">// 修正错误，需要加上自执行</span>
<span class="hljs-keyword">const</span> imgLazyLoad = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
   <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
		<span class="hljs-keyword">let</span> deleteIndexList = [];
		imgList.forEach(<span class="hljs-function">(<span class="hljs-params">img, index</span>) =&gt;</span> &#123;
			<span class="hljs-keyword">let</span> rect = img.getBoundingClientRect()
			<span class="hljs-keyword">if</span> (rect.top &lt; <span class="hljs-built_in">window</span>.innerHeight) &#123;
				img.src = img.dataset.src;
				deleteIndexList.push(index);
				count++;
				<span class="hljs-keyword">if</span> (count === length) &#123;
					<span class="hljs-built_in">document</span>.removeEventListener(<span class="hljs-string">&#x27;scroll&#x27;</span>, imgLazyLoad);
				&#125;
			&#125;
		&#125;)
		imgList = imgList.filter(<span class="hljs-function">(<span class="hljs-params">img, index</span>) =&gt;</span> !deleteIndexList.includes(index));
   &#125;
&#125;)()

<span class="hljs-comment">// 这里最好加上防抖处理</span>
<span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">&#x27;scroll&#x27;</span>, imgLazyLoad)</code></pre>

<h3 id="10-闭包-作用域链"><a href="#10-闭包-作用域链" class="headerlink" title="10 闭包/作用域链"></a>10 闭包/作用域链</h3><p>JavaScript代码的整个执行过程，分为两个阶段，代码<strong>编译阶段</strong>与代码<strong>执行阶段</strong>。</p>
<ul>
<li>编译阶段由编译器完成，将代码翻译成可执行代码，这个阶段作用域规则会确定。</li>
<li>执行阶段由引擎完成，主要任务是执行可执行代码，执行上下文在这个阶段创建。</li>
</ul>
<img src="https://i.loli.net/2021/06/07/SYyLVzKbrEBIo2e.png" srcset="/img/loading.gif" >

<p>执行上下文的生命周期：</p>
<img src="https://i.loli.net/2021/06/07/L4pMAozZuyDtwv7.png" srcset="/img/loading.gif" >

<p>作用域:<br>ES5 中只存在两种作用域：<strong>全局作用域</strong>和<strong>函数作用域</strong>。<br>在 JavaScript 中，我们将作用域定义为一套规则，这套规则用来管理引擎如何在当前作用域<br>以及嵌套子作用域中根据标识符名称进行变量（变量名或者函数名）查找</p>
<p>作用域链:<br>当访问一个变量，编译器在执行这段代码时，会首先从当前的作用域中查找是否有这个标识符，<br>如果没有找到，就会去父作用域查找，如果父作用域还没找到继续向上查找，直到全局作用域为止.<br>作用域链 —— 就是有当前作用域与上层作用域的一系列变量对象组成，它保证了当前执行的作用域对符合访问权限的变量和函数的有序访问。</p>
<pre><code class="hljs javaScript"><span class="hljs-comment">// 使用闭包实现每隔一秒打印 1,2,3,4</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) &#123;
	(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i</span>) </span>&#123;
		<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(i), <span class="hljs-number">1000</span> * i)
	&#125;)(i)
&#125;</code></pre>

<h2 id="二-字符串"><a href="#二-字符串" class="headerlink" title="二 字符串"></a>二 字符串</h2><p>1 判断是不是回文字符串<br>2 JSON.stringify<br>3 解析 URL 参数为对象<br>4 字符串模板<br>5 转驼峰<br>6 找到出现次数最多的字符和个数<br>7 切花字符串大小写<br>8 去掉字符串中的空格</p>
<h3 id="1-判断一个字符串是不是回文字符串"><a href="#1-判断一个字符串是不是回文字符串" class="headerlink" title="1 判断一个字符串是不是回文字符串"></a>1 判断一个字符串是不是回文字符串</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isPalindrome</span>(<span class="hljs-params">str</span>) </span>&#123;
    str = str.replace(<span class="hljs-regexp">/\W/g</span>, <span class="hljs-string">&#x27;&#x27;</span>).toLowerCase();
    <span class="hljs-keyword">return</span> (str == str.split(<span class="hljs-string">&#x27;&#x27;</span>).reverse().join(<span class="hljs-string">&#x27;&#x27;</span>));
&#125;
</code></pre>

<h3 id="2-JSON-stringify"><a href="#2-JSON-stringify" class="headerlink" title="2 JSON.stringify"></a>2 JSON.stringify</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jsonStringify</span>(<span class="hljs-params">obj</span>) </span>&#123;
	<span class="hljs-keyword">let</span> type = <span class="hljs-keyword">typeof</span> obj;
	<span class="hljs-keyword">if</span> (type !== <span class="hljs-string">&quot;object&quot;</span> || type === <span class="hljs-literal">null</span>) &#123;
		<span class="hljs-keyword">if</span> (<span class="hljs-regexp">/string|undefined|function/</span>.test(type)) &#123;
			obj = <span class="hljs-string">&#x27;&quot;&#x27;</span> + obj + <span class="hljs-string">&#x27;&quot;&#x27;</span>;
		&#125;
		<span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>(obj);
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">let</span> json = [];
		<span class="hljs-keyword">let</span> arr = (obj &amp;&amp; obj.constructor === <span class="hljs-built_in">Array</span>);
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k <span class="hljs-keyword">in</span> obj) &#123;
			<span class="hljs-keyword">let</span> v = obj[k];
			<span class="hljs-keyword">let</span> type = <span class="hljs-keyword">typeof</span> v;
			<span class="hljs-keyword">if</span> (<span class="hljs-regexp">/string|undefined|function/</span>.test(type)) &#123;
				v = <span class="hljs-string">&#x27;&quot;&#x27;</span> + v + <span class="hljs-string">&#x27;&quot;&#x27;</span>;
			&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&quot;object&quot;</span>) &#123;
				v = jsonStringify(v);
			&#125;
			json.push((arr ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&#x27;&quot;&#x27;</span> + k + <span class="hljs-string">&#x27;&quot;:&#x27;</span>) + <span class="hljs-built_in">String</span>(v));
		&#125;
		<span class="hljs-keyword">return</span> (arr ? <span class="hljs-string">&quot;[&quot;</span> : <span class="hljs-string">&quot;&#123;&quot;</span>) + <span class="hljs-built_in">String</span>(json) + (arr ? <span class="hljs-string">&quot;]&quot;</span> : <span class="hljs-string">&quot;&#125;&quot;</span>)
	&#125;
&#125;

<span class="hljs-comment">// var json = &#x27;&#123;&quot;a&quot;:&quot;1&quot;, &quot;b&quot;:2&#125;&#x27;;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jsonEval</span>(<span class="hljs-params">json</span>) </span>&#123;
	<span class="hljs-comment">// obj 就是 json 反序列化之后得到的对象</span>
	<span class="hljs-keyword">var</span> rx_one = <span class="hljs-regexp">/^[\],:&#123;&#125;\s]*$/</span>;
	<span class="hljs-keyword">var</span> rx_two = <span class="hljs-regexp">/\\(?:[&quot;\\\/bfnrt]|u[0-9a-fA-F]&#123;4&#125;)/g</span>;
	<span class="hljs-keyword">var</span> rx_three = <span class="hljs-regexp">/&quot;[^&quot;\\\n\r]*&quot;|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g</span>;
	<span class="hljs-keyword">var</span> rx_four = <span class="hljs-regexp">/(?:^|:|,)(?:\s*\[)+/g</span>;

	<span class="hljs-keyword">if</span> (
		rx_one.test(
			json.replace(rx_two, <span class="hljs-string">&quot;@&quot;</span>)
					.replace(rx_three, <span class="hljs-string">&quot;]&quot;</span>)
					.replace(rx_four, <span class="hljs-string">&quot;&quot;</span>)
		)
	) &#123;
		<span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;(&quot;</span> +json + <span class="hljs-string">&quot;)&quot;</span>);
	&#125;

	<span class="hljs-comment">// 或者直接 return eval(&quot;(&quot; +json + &quot;)&quot;);</span>
	<span class="hljs-comment">// 但是会造成XSS攻击</span>
&#125;
</code></pre>

<pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jsonParse</span>(<span class="hljs-params">opt</span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;(&#x27;</span> + opt + <span class="hljs-string">&#x27;)&#x27;</span>);
&#125;
<span class="hljs-comment">// 它会执行JS代码，有XSS漏洞。</span>
<span class="hljs-comment">// 如果你只想记这个方法，就得对参数json做校验</span>
<span class="hljs-keyword">var</span> rx_one = <span class="hljs-regexp">/^[],:&#123;&#125;s]*$/</span>;
<span class="hljs-keyword">var</span> rx_two = <span class="hljs-regexp">/(?:[&quot;/bfnrt]|u[0-9a-fA-F]&#123;4&#125;)/g</span>;
<span class="hljs-keyword">var</span> rx_three = <span class="hljs-regexp">/&quot;[^&quot;nr]*&quot;|true|false|null|-?d+(?:.d*)?(?:[eE][+-]?d+)?/g</span>;
<span class="hljs-keyword">var</span> rx_four = <span class="hljs-regexp">/(?:^|:|,)(?:s*[)+/g;</span>
<span class="hljs-regexp">if (</span>
<span class="hljs-regexp">    rx_one.test(</span>
<span class="hljs-regexp">        json</span>
<span class="hljs-regexp"> .replace(rx_two, &quot;@&quot;)</span>
<span class="hljs-regexp"> .replace(rx_three, &quot;]&quot;)</span>
<span class="hljs-regexp"> .replace(rx_four, &quot;&quot;)</span>
<span class="hljs-regexp"> )</span>
<span class="hljs-regexp">) &#123;</span>
<span class="hljs-regexp"> var obj = eval(&quot;(&quot; +json + &quot;)&quot;);</span>
<span class="hljs-regexp">&#125;</span></code></pre>

<h3 id="3-解析-URL-参数为对象"><a href="#3-解析-URL-参数为对象" class="headerlink" title="3 解析 URL 参数为对象"></a>3 解析 URL 参数为对象</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseParam</span>(<span class="hljs-params">url</span>) </span>&#123;
	<span class="hljs-comment">// 将 ? 后面的字符串取出来</span>
	<span class="hljs-keyword">const</span> paramsStr = <span class="hljs-regexp">/.+\?(.+)$/</span>.exec(url)[<span class="hljs-number">1</span>];
	<span class="hljs-comment">// 将字符串以 &amp; 分割后存到数组中</span>
	<span class="hljs-keyword">const</span> paramsArr = paramsStr.split(<span class="hljs-string">&#x27;&amp;&#x27;</span>);
	<span class="hljs-keyword">let</span> paramsObj = &#123;&#125;;
	<span class="hljs-comment">// 将 params 存到对象中</span>
	paramsArr.forEach(<span class="hljs-function"><span class="hljs-params">param</span> =&gt;</span> &#123;
		<span class="hljs-keyword">if</span> (<span class="hljs-regexp">/=/</span>.test(param)) &#123; <span class="hljs-comment">// 处理有 value 的参数</span>
		 	<span class="hljs-comment">// 分割 key 和 value</span>
			<span class="hljs-keyword">let</span> [key, val] = param.split(<span class="hljs-string">&#x27;=&#x27;</span>);
			val = <span class="hljs-built_in">decodeURIComponent</span>(val); <span class="hljs-comment">// 解码</span>
			<span class="hljs-comment">// 判断是否转为数字</span>
			val = <span class="hljs-regexp">/^\d+$/</span>.test(val) ? <span class="hljs-built_in">parseFloat</span>(val) : val;
	 		<span class="hljs-comment">// 如果对象有 key，则添加一个值</span>
			<span class="hljs-keyword">if</span> (paramsObj.hasOwnProperty(key)) &#123;
					paramsObj[key] = [].concat(paramsObj[key], val);
			&#125; <span class="hljs-keyword">else</span> &#123;
				<span class="hljs-comment">// 如果对象没有这个 key，创建 key 并设置值</span>
				paramsObj[key] = val;
			&#125;
		&#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// 处理没有 value 的参数</span>
			paramsObj[param] = <span class="hljs-literal">true</span>;
		&#125;
	&#125;)
	
	<span class="hljs-keyword">return</span> paramsObj;
&#125;

parseParam(<span class="hljs-string">&#x27;www.baidu.com?name=Ronaldo&amp;age=45&amp;contry&#x27;</span>)
<span class="hljs-comment">// &#123;</span>
<span class="hljs-comment">// 	age: 45</span>
<span class="hljs-comment">// 	contry: true</span>
<span class="hljs-comment">// 	name: &quot;Ronaldo&quot;</span>
<span class="hljs-comment">// &#125;</span>

<span class="hljs-keyword">let</span> url = <span class="hljs-string">&#x27;http://www.domain.com/?user=anonymous&amp;id=123&amp;id=456&amp;city=%E5%8C%97%E4%BA%AC&amp;enabled&#x27;</span>;
parseParam(url)
<span class="hljs-comment">/* 结果</span>
<span class="hljs-comment">&#123; user: &#x27;anonymous&#x27;,</span>
<span class="hljs-comment">  id: [ 123, 456 ], // 重复出现的 key 要组装成数组，能被转成数字的就转成数字类型</span>
<span class="hljs-comment">  city: &#x27;北京&#x27;, // 中文需解码</span>
<span class="hljs-comment">  enabled: true, // 未指定值得 key 约定为 true</span>
<span class="hljs-comment">&#125;</span>
<span class="hljs-comment">*/</span></code></pre>

<h3 id="4-字符串模板"><a href="#4-字符串模板" class="headerlink" title="4 字符串模板"></a>4 字符串模板</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">template, data</span>) </span>&#123;
	<span class="hljs-comment">// 模板字符串正则</span>
	<span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/\&#123;\&#123;(\w+)\&#125;\&#125;/</span>;
	<span class="hljs-comment">// 判断模板里是否有模板字符串</span>
	<span class="hljs-keyword">if</span> (reg.test(template)) &#123;
		<span class="hljs-comment">// 查找当前模板里第一个模板字符串的字段</span>
		<span class="hljs-keyword">const</span> name = reg.exec(template)[<span class="hljs-number">1</span>];
		<span class="hljs-comment">// 将第一个模板字符串渲染</span>
		template = template.replace(reg, data[name]); 
		<span class="hljs-comment">// 递归的渲染并返回渲染后的结构</span>
		<span class="hljs-keyword">return</span> render(template, data); 
	&#125;
	<span class="hljs-keyword">return</span> template; <span class="hljs-comment">// 如果模板没有模板字符串直接返回</span>
&#125;

<span class="hljs-comment">// test</span>
<span class="hljs-keyword">let</span> template = <span class="hljs-string">&#x27;我是&#123;&#123;name&#125;&#125;，年龄&#123;&#123;age&#125;&#125;，性别&#123;&#123;sex&#125;&#125;&#x27;</span>;
<span class="hljs-keyword">let</span> person = &#123;
    name: <span class="hljs-string">&#x27;布兰&#x27;</span>,
    age: <span class="hljs-number">12</span>
&#125;
render(template, person); <span class="hljs-comment">// 我是布兰，年龄12，性别undefined</span></code></pre>

<h3 id="5-转驼峰"><a href="#5-转驼峰" class="headerlink" title="5 转驼峰"></a>5 转驼峰</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 解法一 正则 replace</span>
<span class="hljs-comment">// 1-1.驼峰式转下横线：</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toLowerLine</span>(<span class="hljs-params">str</span>) </span>&#123;
	<span class="hljs-keyword">var</span> resStr = str.replace(<span class="hljs-regexp">/[A-Z]/g</span>, <span class="hljs-function"><span class="hljs-params">match</span> =&gt;</span> <span class="hljs-string">&quot;_&quot;</span> + match.toLowerCase());
	<span class="hljs-comment">//如果首字母是大写，执行replace时会多一个_ ,这里需要去掉</span>
  	<span class="hljs-keyword">if</span>(resStr.slice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) === <span class="hljs-string">&#x27;_&#x27;</span>) &#123; <span class="hljs-comment">// resStr.startsWith(&#x27;_&#x27;)</span>
  		resStr = resStr.slice(<span class="hljs-number">1</span>);
  	&#125;
	<span class="hljs-keyword">return</span> resStr;
&#125;;
<span class="hljs-comment">// test:</span>
toLowerLine(<span class="hljs-string">&quot;TestToLowerLine&quot;</span>);  <span class="hljs-comment">//test_to_lower_line</span>
toLowerLine(<span class="hljs-string">&quot;testToLowerLine&quot;</span>);  <span class="hljs-comment">//test_to_lower_line</span>

<span class="hljs-comment">// 1-2.下横线转驼峰式：</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toCamel</span>(<span class="hljs-params">str</span>) </span>&#123;
  	<span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/([^_])(?:_+([^_]))/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">match, $<span class="hljs-number">1</span>, $<span class="hljs-number">2</span></span>) </span>&#123;
		<span class="hljs-comment">// match=t_b, $1=t, $2=b</span>
		<span class="hljs-comment">// match=e_c, $1=e, $2=c</span>
		<span class="hljs-keyword">return</span> $<span class="hljs-number">1</span> + $<span class="hljs-number">2.</span>toUpperCase();
  	&#125;);
&#125;
<span class="hljs-comment">// test</span>
toCamel(<span class="hljs-string">&#x27;test_be_camel&#x27;</span>) <span class="hljs-comment">// testBeCamel</span>

<span class="hljs-comment">// 解法二: reduce</span>
<span class="hljs-comment">// 2-1.驼峰式转下横线：</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toLowerLine</span>(<span class="hljs-params">str</span>)</span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.prototype.reduce.call(str, <span class="hljs-function">(<span class="hljs-params">pre, cur, index</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">if</span>(<span class="hljs-regexp">/[A-Z]/</span>.test(cur))&#123;
			cur = cur.toLowerCase();
			<span class="hljs-keyword">return</span> index === <span class="hljs-number">0</span> ? pre + cur :  pre + <span class="hljs-string">&#x27;_&#x27;</span> + cur
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">return</span> pre + cur;
		&#125;
	&#125;, <span class="hljs-string">&#x27;&#x27;</span>)
&#125;
<span class="hljs-comment">// test</span>
toLowerLine(<span class="hljs-string">&#x27;TestToLowerLine&#x27;</span>); <span class="hljs-comment">// test_to_lower_line</span>

<span class="hljs-comment">// 2-2.下横线转驼峰式：</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toCamel</span>(<span class="hljs-params">str</span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.prototype.reduce.call(str, <span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">if</span> (pre.endsWith(<span class="hljs-string">&#x27;_&#x27;</span>)) &#123;
			<span class="hljs-keyword">return</span> pre.substring(<span class="hljs-number">0</span>, pre.length - <span class="hljs-number">1</span>) + cur.toUpperCase();
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">return</span> pre + cur;
		&#125;
	&#125;)
&#125;
<span class="hljs-comment">// test</span>
toCamel(<span class="hljs-string">&#x27;test_to_camel&#x27;</span>); <span class="hljs-comment">// testToCamel</span>

<span class="hljs-comment">// 解法三: Array.map()</span>
<span class="hljs-comment">// 3-1.驼峰式转下横线：</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toLowerLine</span>(<span class="hljs-params">arr</span>)</span>&#123;
	<span class="hljs-comment">// return [].map.call(arr, doLowerLine).join(&#x27;&#x27;);</span>
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.prototype.map.call(arr, <span class="hljs-function">(<span class="hljs-params">val, index</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">if</span>(<span class="hljs-regexp">/[A-Z]/</span>.test(val))&#123;
			<span class="hljs-keyword">return</span> index === <span class="hljs-number">0</span> ? val.toLowerCase() : <span class="hljs-string">&#x27;_&#x27;</span> + val.toLowerCase();
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">return</span> val;
		&#125;
	&#125;).join(<span class="hljs-string">&#x27;&#x27;</span>);
&#125;</code></pre>

<h3 id="6-找到出现次数最多的字符和个数"><a href="#6-找到出现次数最多的字符和个数" class="headerlink" title="6 找到出现次数最多的字符和个数"></a>6 找到出现次数最多的字符和个数</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMore</span>(<span class="hljs-params">str</span>) </span>&#123;
	<span class="hljs-comment">// str = &quot;abcabcabcbbccccc&quot;</span>
	<span class="hljs-keyword">let</span> num = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">let</span> char = <span class="hljs-string">&#x27;&#x27;</span>;

	<span class="hljs-comment">// 使其按照一定的次序排列</span>
	str = str.split(<span class="hljs-string">&#x27;&#x27;</span>).sort().join(<span class="hljs-string">&#x27;&#x27;</span>);
	<span class="hljs-comment">// str = &quot;aaabbbbbcccccccc&quot;</span>

	<span class="hljs-comment">// 定义正则表达式</span>
	<span class="hljs-keyword">let</span> re = <span class="hljs-regexp">/(\w)\1+/g</span>;
	str.replace(re,<span class="hljs-function">(<span class="hljs-params">$<span class="hljs-number">0</span>,$<span class="hljs-number">1</span></span>) =&gt;</span> &#123;
		<span class="hljs-keyword">if</span>(num &lt; $<span class="hljs-number">0.</span>length)&#123;
			num = $<span class="hljs-number">0.</span>length;
			char = $<span class="hljs-number">1</span>;        
		&#125;
	&#125;);
	<span class="hljs-keyword">return</span> &#123;
		num,
		char,
	&#125;
&#125;</code></pre>

<h3 id="7-切花字符串大小写"><a href="#7-切花字符串大小写" class="headerlink" title="7 切花字符串大小写"></a>7 切花字符串大小写</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">caseConvert</span>(<span class="hljs-params">str</span>)</span>&#123;
   <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/([a-z]*)([A-Z]*)/g</span>, <span class="hljs-function">(<span class="hljs-params">m, s1, s2</span>)=&gt;</span>&#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;s1.toUpperCase()&#125;</span><span class="hljs-subst">$&#123;s2.toLowerCase()&#125;</span>`</span>
   &#125;)
&#125;
caseConvert(<span class="hljs-string">&#x27;AsA33322A2aa&#x27;</span>) <span class="hljs-comment">//aSa33322a2AA</span></code></pre>

<h3 id="8-去掉字符串中的空格"><a href="#8-去掉字符串中的空格" class="headerlink" title="8 去掉字符串中的空格"></a>8 去掉字符串中的空格</h3><pre><code class="hljs javaScript"> 
<span class="hljs-keyword">const</span> POSITION = <span class="hljs-built_in">Object</span>.freeze(&#123;
  left: <span class="hljs-built_in">Symbol</span>(), <span class="hljs-comment">// 左</span>
  right: <span class="hljs-built_in">Symbol</span>(), <span class="hljs-comment">// 右</span>
  both: <span class="hljs-built_in">Symbol</span>(), <span class="hljs-comment">// 左右</span>
  center: <span class="hljs-built_in">Symbol</span>(), <span class="hljs-comment">// 中间</span>
  all: <span class="hljs-built_in">Symbol</span>(), <span class="hljs-comment">// 全部</span>
&#125;)
 
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trim</span>(<span class="hljs-params">str, position = POSITION.both</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (!!POSITION[position]) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;unexpected position value&#x27;</span>)
	
	<span class="hljs-keyword">switch</span>(position) &#123;
		<span class="hljs-keyword">case</span>(POSITION.left):
			str = str.replace(<span class="hljs-regexp">/^\s+/</span>, <span class="hljs-string">&#x27;&#x27;</span>)
			<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span>(POSITION.right):
			str = str.replace(<span class="hljs-regexp">/\s+$/</span>, <span class="hljs-string">&#x27;&#x27;</span>)
			<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span>(POSITION.both):
			str = str.replace(<span class="hljs-regexp">/^\s+/</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-regexp">/\s+$/</span>, <span class="hljs-string">&#x27;&#x27;</span>)
			<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span>(POSITION.center):
			<span class="hljs-keyword">while</span> (str.match(<span class="hljs-regexp">/\w\s+\w/</span>)) &#123;
				str = str.replace(<span class="hljs-regexp">/(\w)(\s+)(\w)/</span>, <span class="hljs-string">`$1$3`</span>)
			&#125;
			<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span>(POSITION.all):
			str = str.replace(<span class="hljs-regexp">/\s/g</span>, <span class="hljs-string">&#x27;&#x27;</span>)
			<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">default</span>: 
	&#125;
	
	<span class="hljs-keyword">return</span> str;
&#125;

<span class="hljs-keyword">const</span> str = <span class="hljs-string">&#x27;  s t  r  &#x27;</span>
<span class="hljs-keyword">const</span> result = trim(str)
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`|<span class="hljs-subst">$&#123;result&#125;</span>|`</span>) <span class="hljs-comment">//  |s t  r| </span></code></pre>

<h2 id="三-Object"><a href="#三-Object" class="headerlink" title="三 Object"></a>三 Object</h2><p>1 Symbol（for…in/of）<br>2 继承<br>3 双向绑定<br>4 发布订阅模式<br>5 观察者模式<br>6 Object.assign<br>7 EventEmitter</p>
<h3 id="1-Symbol（for…in-of）"><a href="#1-Symbol（for…in-of）" class="headerlink" title="1 Symbol（for…in/of）"></a>1 Symbol（for…in/of）</h3><p>Symbol: 可以用来表示一个独一无二的变量防止命名冲突.</p>
<p>Symbol作用：</p>
<ol>
<li>还可以利用 symbol 不会被常规的方法（除了 <code>Object.getOwnPropertySymbols</code> 外）遍历到，所以可以用来模拟私有变量。</li>
<li>用来提供遍历接口，布置了 <code>symbol.iterator</code> 的对象才可以使用 <code>for···of</code> 循环，可以统一处理数据结构。<br>调用之后回返回一个遍历器对象，包含有一个 next 方法，使用 next 方法后有两个返回值 value 和 done 分别表示函数当前执行位置的值和是否遍历完毕。</li>
</ol>
<p><code>Symbol.for()</code> 可以在全局访问 symbol</p>
<ul>
<li>for……in : 遍历 key,</li>
<li>for……of : 遍历 value,</li>
</ul>
<p>ES6 规定，默认的 Iterator 接口部署在数据结构的 Symbol.iterator 属性。或者说，一个数据结构只要具有Symbol.iterator属性，就可以认为是“可遍历的”（iterable）。<br>Symbol.iterator 属性本身是一个函数，就是当前数据结构默认的遍历器生成函数。</p>
<p>因为object 没有 Symbol.iterator 属性，所以不能被 for…of 遍历。</p>
<pre><code class="hljs javaScript"><span class="hljs-keyword">const</span> text = &#123;
	a: <span class="hljs-number">1</span>,
	b: <span class="hljs-number">2</span>,
	c:<span class="hljs-number">3</span>
&#125;
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i <span class="hljs-keyword">of</span> text)&#123;
	<span class="hljs-built_in">console</span>.log(i) <span class="hljs-comment">// 报错：Uncaught TypeError: text is not iterable</span>
&#125;</code></pre>

<p>所以，object想要被 for…of遍历 ，必须在原来的基础上加上 Symbol.iterator 接口属性。</p>
<pre><code class="hljs javaScript"><span class="hljs-keyword">const</span> text = &#123;
	a: <span class="hljs-number">1</span>,
	b: <span class="hljs-number">2</span>,
	c: <span class="hljs-number">3</span>,
&#125;;
<span class="hljs-comment">// 给对象加上 iterator 接口,使之能被 for…of 遍历</span>
text[<span class="hljs-built_in">Symbol</span>.iterator] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>&#123;
	<span class="hljs-keyword">const</span> _this = <span class="hljs-built_in">this</span>;
	<span class="hljs-keyword">return</span> &#123;
		index: -<span class="hljs-number">1</span>,
		<span class="hljs-function"><span class="hljs-title">next</span>(<span class="hljs-params"></span>)</span> &#123;
			<span class="hljs-keyword">const</span> arr = <span class="hljs-built_in">Object</span>.keys(_this);
			<span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.index &lt; arr.length)&#123;
				<span class="hljs-built_in">this</span>.index++;
				<span class="hljs-keyword">return</span> &#123;
					value: _this[arr[<span class="hljs-built_in">this</span>.index]],
					done: <span class="hljs-literal">false</span>,
				&#125;
			&#125; <span class="hljs-keyword">else</span> &#123;
				<span class="hljs-keyword">return</span> &#123;
					value: <span class="hljs-literal">undefined</span>,
					done: <span class="hljs-literal">true</span>,
				&#125;
			&#125;
		&#125;
	&#125;
&#125;

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i <span class="hljs-keyword">of</span> text)&#123;
	<span class="hljs-built_in">console</span>.log(i) <span class="hljs-comment">// 1 2 3 undefined</span>
&#125;</code></pre>

<h3 id="2-继承"><a href="#2-继承" class="headerlink" title="2 继承"></a>2 继承</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 1 原型链继承</span>
<span class="hljs-comment">// 缺点：</span>
<span class="hljs-comment">// 问题1：原型中包含的引用类型属性将被所有实例共享；</span>
<span class="hljs-comment">// 问题2：子类在实例化的时候不能给父类构造函数传参；</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Animal</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-built_in">this</span>.colors = [<span class="hljs-string">&#x27;black&#x27;</span>, <span class="hljs-string">&#x27;white&#x27;</span>]
&#125;
Animal.prototype.getColor = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.colors
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Dog</span>(<span class="hljs-params"></span>) </span>&#123;&#125;
Dog.prototype =  <span class="hljs-keyword">new</span> Animal()

<span class="hljs-keyword">let</span> dog1 = <span class="hljs-keyword">new</span> Dog()
dog1.colors.push(<span class="hljs-string">&#x27;brown&#x27;</span>)
<span class="hljs-keyword">let</span> dog2 = <span class="hljs-keyword">new</span> Dog()
<span class="hljs-built_in">console</span>.log(dog2.colors)  <span class="hljs-comment">// [&#x27;black&#x27;, &#x27;white&#x27;, &#x27;brown&#x27;]</span>

<span class="hljs-comment">// 2 借用构造函数实现继承</span>
<span class="hljs-comment">// 借用构造函数实现继承解决了原型链继承的 2 个问题:</span>
<span class="hljs-comment">// 引用类型共享问题以及传参问题。</span>
<span class="hljs-comment">// 但是由于方法必须定义在构造函数中，所以会导致每次创建子类实例都会创建一遍方法。</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Animal</span>(<span class="hljs-params">name</span>) </span>&#123;
	<span class="hljs-built_in">this</span>.name = name
	<span class="hljs-built_in">this</span>.getName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
		<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name
	&#125;
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Dog</span>(<span class="hljs-params">name</span>) </span>&#123;
	Animal.call(<span class="hljs-built_in">this</span>, name)
&#125;
Dog.prototype =  <span class="hljs-keyword">new</span> Animal()

<span class="hljs-comment">// 3 组合继承</span>
<span class="hljs-comment">// 组合继承结合了原型链和盗用构造函数，将两者的优点集中了起来。</span>
<span class="hljs-comment">// 基本的思路是使用原型链继承原型上的属性和方法，而通过盗用构造函数继承实例属性。</span>
<span class="hljs-comment">// 这样既可以把方法定义在原型上以实现重用，又可以让每个实例都有自己的属性。</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Animal</span>(<span class="hljs-params">name</span>) </span>&#123;
	<span class="hljs-built_in">this</span>.name = name
	<span class="hljs-built_in">this</span>.colors = [<span class="hljs-string">&#x27;black&#x27;</span>, <span class="hljs-string">&#x27;white&#x27;</span>]
&#125;
Animal.prototype.getName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Dog</span>(<span class="hljs-params">name, age</span>) </span>&#123;
	Animal.call(<span class="hljs-built_in">this</span>, name)
	<span class="hljs-built_in">this</span>.age = age
&#125;
Dog.prototype = <span class="hljs-keyword">new</span> Animal()
Dog.prototype.constructor = Dog

<span class="hljs-keyword">let</span> dog1 = <span class="hljs-keyword">new</span> Dog(<span class="hljs-string">&#x27;奶昔&#x27;</span>, <span class="hljs-number">2</span>)
dog1.colors.push(<span class="hljs-string">&#x27;brown&#x27;</span>)
<span class="hljs-keyword">let</span> dog2 = <span class="hljs-keyword">new</span> Dog(<span class="hljs-string">&#x27;哈赤&#x27;</span>, <span class="hljs-number">1</span>)
<span class="hljs-built_in">console</span>.log(dog2) 
<span class="hljs-comment">// &#123; name: &quot;哈赤&quot;, colors: [&quot;black&quot;, &quot;white&quot;], age: 1 &#125;</span>

<span class="hljs-comment">// 4 寄生式组合继承</span>
<span class="hljs-comment">// 组合继承已经相对完善了，但还是存在问题:</span>
<span class="hljs-comment">// 它的问题就是调用了 2 次父类构造函数，第一次是在 new Animal()，第二次是在 Animal.call() 这里。</span>
<span class="hljs-comment">// 所以解决方案就是不直接调用父类构造函数给子类原型赋值，而是通过创建空函数 F 获取父类原型的副本。</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Animal</span>(<span class="hljs-params">name</span>) </span>&#123;
	<span class="hljs-built_in">this</span>.name = name
	<span class="hljs-built_in">this</span>.colors = [<span class="hljs-string">&#x27;black&#x27;</span>, <span class="hljs-string">&#x27;white&#x27;</span>]
&#125;
Animal.prototype.getName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Dog</span>(<span class="hljs-params">name, age</span>) </span>&#123;
	Animal.call(<span class="hljs-built_in">this</span>, name)
	<span class="hljs-built_in">this</span>.age = age
&#125;

Dog.prototype =  <span class="hljs-built_in">Object</span>.create(Animal.prototype)
Dog.prototype.constructor = Dog

<span class="hljs-keyword">let</span> dog1 = <span class="hljs-keyword">new</span> Dog(<span class="hljs-string">&#x27;奶昔&#x27;</span>, <span class="hljs-number">2</span>)
dog1.colors.push(<span class="hljs-string">&#x27;brown&#x27;</span>)
<span class="hljs-keyword">let</span> dog2 = <span class="hljs-keyword">new</span> Dog(<span class="hljs-string">&#x27;哈赤&#x27;</span>, <span class="hljs-number">1</span>)
<span class="hljs-built_in">console</span>.log(dog2) 
<span class="hljs-comment">// &#123; name: &quot;哈赤&quot;, colors: [&quot;black&quot;, &quot;white&quot;], age: 1 &#125;</span></code></pre>

<h3 id="3-双向绑定"><a href="#3-双向绑定" class="headerlink" title="3 双向绑定"></a>3 双向绑定</h3><pre><code class="hljs javaScript">&lt;body&gt;
	&lt;input type=<span class="hljs-string">&quot;text&quot;</span> id=<span class="hljs-string">&quot;model&quot;</span> /&gt;
	&lt;div id=<span class="hljs-string">&quot;modelText&quot;</span>&gt;&lt;/div&gt;
&lt;/body&gt;

<span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">var</span> user = &#123;
		name: <span class="hljs-string">&#x27;aaaa&#x27;</span>
	&#125;;
	<span class="hljs-keyword">var</span> input = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&quot;#model&quot;</span>);
	<span class="hljs-keyword">var</span> text = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&quot;#modelText&quot;</span>);
	input.value = user.name;
	text.textContent = user.name;
	<span class="hljs-comment">// 数据到视图 model =&gt; view</span>
	<span class="hljs-built_in">Object</span>.defineProperty(user, <span class="hljs-string">&quot;name&quot;</span>, &#123;
		get:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;
			<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;获取user&#x27;</span>)
		&#125;,
		set:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>)</span>&#123;
			<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;修改user&#x27;</span>)
			input.value = val;
			text.textContent = val;
		&#125;
	&#125;)
	<span class="hljs-comment">// 视图到数据 view =&gt; model (可以监听 input 和 keyup)</span>
	input.addEventListener(<span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>)</span>&#123;
		user.name = input.value;
	&#125;)
	<span class="hljs-comment">// 输入框发生的事件流程依次为</span>
	<span class="hljs-comment">// focus -&gt; keydown -&gt; input -&gt; keyup -&gt; change -&gt; blur</span>
&#125;</code></pre>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39516865/article/details/111388183">手写bind_手写JavaScript几个方法</a><br><a target="_blank" rel="noopener" href="https://github.com/YvetteLau/Blog/issues/35">github-blog</a></p>
</blockquote>
<h3 id="4-发布订阅模式"><a href="#4-发布订阅模式" class="headerlink" title="4 发布订阅模式"></a>4 发布订阅模式</h3><pre><code class="hljs javaScript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventEmitter</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span> &#123;
        <span class="hljs-built_in">this</span>.cache = &#123;&#125;;
    &#125;
    <span class="hljs-function"><span class="hljs-title">on</span>(<span class="hljs-params">name, fn</span>)</span> &#123;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.cache[name]) &#123;
            <span class="hljs-built_in">this</span>.cache[name].push(fn);
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">this</span>.cache[name] = [fn];
        &#125;
    &#125;
    <span class="hljs-function"><span class="hljs-title">off</span>(<span class="hljs-params">name, fn</span>)</span> &#123;
        <span class="hljs-keyword">let</span> tasks = <span class="hljs-built_in">this</span>.cache[name];
        <span class="hljs-keyword">if</span> (tasks) &#123;
            <span class="hljs-keyword">const</span> index = tasks.findIndex(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f === fn || f.callback === fn)
            <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) &#123;
                tasks.splice(index, <span class="hljs-number">1</span>)
            &#125;
        &#125;
    &#125;
    <span class="hljs-function"><span class="hljs-title">emit</span>(<span class="hljs-params">name, once = <span class="hljs-literal">false</span>, ...args</span>)</span> &#123;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.cache[name]) &#123;
            <span class="hljs-comment">// 创建副本，如果回调函数内继续注册相同事件，会造成死循环</span>
            <span class="hljs-keyword">let</span> tasks = <span class="hljs-built_in">this</span>.cache[name].slice()
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> fn <span class="hljs-keyword">of</span> tasks) &#123;
               fn(...args)
            &#125;
            <span class="hljs-keyword">if</span> (once) &#123;
               <span class="hljs-keyword">delete</span> <span class="hljs-built_in">this</span>.cache[name]
            &#125;
        &#125;
    &#125;
&#125;

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">let</span> eventBus = <span class="hljs-keyword">new</span> EventEmitter()
<span class="hljs-keyword">let</span> fn1 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, age</span>) </span>&#123;
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span> <span class="hljs-subst">$&#123;age&#125;</span>`</span>)
&#125;
<span class="hljs-keyword">let</span> fn2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, age</span>) </span>&#123;
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`hello, <span class="hljs-subst">$&#123;name&#125;</span> <span class="hljs-subst">$&#123;age&#125;</span>`</span>)
&#125;
eventBus.on(<span class="hljs-string">&#x27;aaa&#x27;</span>, fn1)
eventBus.on(<span class="hljs-string">&#x27;aaa&#x27;</span>, fn2)
eventBus.emit(<span class="hljs-string">&#x27;aaa&#x27;</span>, <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;布兰&#x27;</span>, <span class="hljs-number">12</span>)
<span class="hljs-comment">// &#x27;布兰 12&#x27;</span>
<span class="hljs-comment">// &#x27;hello, 布兰 12&#x27;</span>
</code></pre>

<h3 id="5-观察者模式"><a href="#5-观察者模式" class="headerlink" title="5 观察者模式"></a>5 观察者模式</h3><pre><code class="hljs javaScript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Subject</span></span>&#123;
	<span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">name</span>)</span>&#123;
		<span class="hljs-built_in">this</span>.name = name
		<span class="hljs-built_in">this</span>.observers = []
		<span class="hljs-built_in">this</span>.state = <span class="hljs-string">&#x27;XXXX&#x27;</span>
	&#125;
	<span class="hljs-comment">// 被观察者要提供一个接受观察者的方法</span>
	<span class="hljs-function"><span class="hljs-title">attach</span>(<span class="hljs-params">observer</span>)</span>&#123;
		<span class="hljs-built_in">this</span>.observers.push(observer)
	&#125;

	<span class="hljs-comment">// 改变被观察着的状态</span>
	<span class="hljs-function"><span class="hljs-title">setState</span>(<span class="hljs-params">newState</span>)</span>&#123;
		<span class="hljs-built_in">this</span>.state = newState
		<span class="hljs-built_in">this</span>.observers.forEach(<span class="hljs-function"><span class="hljs-params">o</span>=&gt;</span>&#123;
			o.update(newState)
		&#125;)
	&#125;
&#125;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Observer</span></span>&#123;
	<span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">name</span>)</span>&#123;
		<span class="hljs-built_in">this</span>.name = name
	&#125;

	<span class="hljs-function"><span class="hljs-title">update</span>(<span class="hljs-params">newState</span>)</span>&#123;
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">this</span>.name&#125;</span>say:<span class="hljs-subst">$&#123;newState&#125;</span>`</span>)
	&#125;
&#125;

<span class="hljs-comment">// 被观察者 灯</span>
<span class="hljs-keyword">let</span> sub = <span class="hljs-keyword">new</span> Subject(<span class="hljs-string">&#x27;灯&#x27;</span>)
<span class="hljs-keyword">let</span> mm = <span class="hljs-keyword">new</span> Observer(<span class="hljs-string">&#x27;小明&#x27;</span>)
<span class="hljs-keyword">let</span> jj = <span class="hljs-keyword">new</span> Observer(<span class="hljs-string">&#x27;小健&#x27;</span>)
 
<span class="hljs-comment">// 订阅 观察者</span>
sub.attach(mm)
sub.attach(jj)
 
sub.setState(<span class="hljs-string">&#x27;灯亮了来电了&#x27;</span>)</code></pre>

<h3 id="6-Object-assign"><a href="#6-Object-assign" class="headerlink" title="6 Object.assign"></a>6 Object.assign</h3><pre><code class="hljs javaScript"><span class="hljs-built_in">Object</span>.assign2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">target, ...source</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (target == <span class="hljs-literal">null</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;Cannot convert undefined or null to object&#x27;</span>)
	&#125;
	<span class="hljs-keyword">let</span> ret = <span class="hljs-built_in">Object</span>(target);
	source.forEach(<span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> &#123;
		<span class="hljs-keyword">if</span> (obj != <span class="hljs-literal">null</span>) &#123;
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> obj) &#123;
				<span class="hljs-keyword">if</span> (obj.hasOwnProperty(key)) &#123;
					ret[key] = obj[key]
				&#125;
			&#125;
		&#125;
	&#125;)
	<span class="hljs-keyword">return</span> ret;
&#125;</code></pre>

<h3 id="7-EventEmitter"><a href="#7-EventEmitter" class="headerlink" title="7 EventEmitter"></a>7 EventEmitter</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 发布订阅模式</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventEmitter</span> </span>&#123;
	<span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span> &#123;
		<span class="hljs-comment">// 事件对象，存放订阅的名字和事件  如:  &#123; click: [ handle1, handle2 ]  &#125;</span>
		<span class="hljs-built_in">this</span>.events = &#123;&#125;;
	&#125;
	<span class="hljs-comment">// 订阅事件的方法</span>
	<span class="hljs-function"><span class="hljs-title">on</span>(<span class="hljs-params">eventName, callback</span>)</span> &#123;
		<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.events[eventName]) &#123;
			<span class="hljs-comment">// 一个名字可以订阅多个事件函数</span>
			<span class="hljs-built_in">this</span>.events[eventName] = [callback];
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-comment">// 存在则push到指定数组的尾部保存</span>
			<span class="hljs-built_in">this</span>.events[eventName].push(callback);
		&#125;
	&#125;
	<span class="hljs-comment">// 触发事件的方法</span>
	<span class="hljs-function"><span class="hljs-title">emit</span>(<span class="hljs-params">eventName, ...rest</span>)</span> &#123;
		<span class="hljs-comment">// 遍历执行所有订阅的事件</span>
		<span class="hljs-built_in">this</span>.events[eventName] &amp;&amp;
			<span class="hljs-built_in">this</span>.events[eventName].forEach(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.apply(<span class="hljs-built_in">this</span>, rest));
	&#125;
	<span class="hljs-comment">// 移除订阅事件</span>
	<span class="hljs-function"><span class="hljs-title">remove</span>(<span class="hljs-params">eventName, callback</span>)</span> &#123;
		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.events[eventName]) &#123;
			<span class="hljs-built_in">this</span>.events[eventName] = <span class="hljs-built_in">this</span>.events[eventName].filter(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f != callback);
		&#125;
	&#125;
	<span class="hljs-comment">// 只执行一次订阅的事件，然后移除</span>
	<span class="hljs-function"><span class="hljs-title">once</span>(<span class="hljs-params">eventName, callback</span>)</span> &#123;
		<span class="hljs-comment">// 绑定的时fn, 执行的时候会触发fn函数</span>
		<span class="hljs-keyword">const</span> fn = <span class="hljs-function">(<span class="hljs-params">...rest</span>) =&gt;</span> &#123;
			callback.apply(<span class="hljs-built_in">this</span>, rest) <span class="hljs-comment">// fn函数中调用原有的callback</span>
			<span class="hljs-built_in">this</span>.remove(eventName, fn) <span class="hljs-comment">// 删除fn, 再次执行的时候之后执行一次</span>
		&#125;
		<span class="hljs-built_in">this</span>.on(eventName, fn)
	&#125;
&#125;


<span class="hljs-comment">// test1</span>
<span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> EventEmitter()

<span class="hljs-keyword">const</span> handle = <span class="hljs-function">(<span class="hljs-params">...pyload</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(pyload)

event.on(<span class="hljs-string">&#x27;click&#x27;</span>, handle)
event.emit(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">300</span>, <span class="hljs-number">100</span>)
event.remove(<span class="hljs-string">&#x27;click&#x27;</span>, handle)
event.once(<span class="hljs-string">&#x27;dbclick&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;click&#x27;</span>)
&#125;)

event.emit(<span class="hljs-string">&#x27;dbclick&#x27;</span>, <span class="hljs-number">100</span>);

<span class="hljs-comment">// test 2</span>
<span class="hljs-keyword">let</span> event = <span class="hljs-keyword">new</span> EventEmitter();

event.on(<span class="hljs-string">&#x27;say&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>&#123;
  <span class="hljs-built_in">console</span>.log(str);
&#125;);

event.once(<span class="hljs-string">&#x27;say&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>&#123;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;这是once:&#x27;</span> + str)
&#125;)

event.emit(<span class="hljs-string">&#x27;say&#x27;</span>,<span class="hljs-string">&#x27;visa&#x27;</span>);
event.emit(<span class="hljs-string">&#x27;say&#x27;</span>,<span class="hljs-string">&#x27;visa222&#x27;</span>);
event.emit(<span class="hljs-string">&#x27;say&#x27;</span>,<span class="hljs-string">&#x27;visa333&#x27;</span>);</code></pre>

<h2 id="四-Promise"><a href="#四-Promise" class="headerlink" title="四 Promise"></a>四 Promise</h2><p>1 手写promise<br>2 实现promise串行<br>3 实现Promise并发调度<br>4 JavaScript并发控制<br>5 手写generator<br>6 用 setTimeout 模拟 setInterval</p>
<h3 id="1-Promise"><a href="#1-Promise" class="headerlink" title="1 Promise"></a>1 Promise</h3><pre><code class="hljs javaScript"><span class="hljs-keyword">const</span> STATUS = &#123;
	PENDING: <span class="hljs-string">&#x27;pending&#x27;</span>,
	FULFILLED: <span class="hljs-string">&#x27;fulfilled&#x27;</span>,
	REJECTED: <span class="hljs-string">&#x27;rejected&#x27;</span>
&#125;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPromise</span> </span>&#123;
	<span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">executor</span>)</span> &#123;
		<span class="hljs-built_in">this</span>._status = STATUS.PENDING; <span class="hljs-comment">// Promise初始状态</span>
		<span class="hljs-built_in">this</span>._value = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// then回调的值</span>
		<span class="hljs-built_in">this</span>._resolveQueue = []; <span class="hljs-comment">// resolve时触发的成功队列</span>
		<span class="hljs-built_in">this</span>._rejectQueue = []; <span class="hljs-comment">// reject时触发的失败队列</span>
	
		<span class="hljs-comment">// 使用箭头函数固定this（resolve函数在executor中触发，不然找不到this）</span>
		<span class="hljs-keyword">const</span> resolve = <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
			<span class="hljs-keyword">const</span> run = <span class="hljs-function">() =&gt;</span> &#123;
				<span class="hljs-comment">// Promise/A+ 规范规定的Promise状态只能从pending触发，变成fulfilled</span>
				<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._status === STATUS.PENDING) &#123;
					<span class="hljs-built_in">this</span>._status = STATUS.FULFILLED; <span class="hljs-comment">// 更改状态</span>
					<span class="hljs-built_in">this</span>._value = value; <span class="hljs-comment">// 储存当前值，用于then回调</span>
		
					<span class="hljs-comment">// 执行resolve回调</span>
					<span class="hljs-keyword">while</span> (<span class="hljs-built_in">this</span>._resolveQueue.length) &#123;
						<span class="hljs-keyword">const</span> callback = <span class="hljs-built_in">this</span>._resolveQueue.shift();
						callback(value);
					&#125;
				&#125;
			&#125;
			<span class="hljs-comment">// 把resolve执行回调的操作封装成一个函数,放进setTimeout里</span>
			<span class="hljs-comment">// 以实现promise异步调用的特性（规范上是微任务，这里是宏任务）</span>
			<span class="hljs-built_in">setTimeout</span>(run);
		&#125;
	
		<span class="hljs-comment">// 同 resolve</span>
		<span class="hljs-keyword">const</span> reject = <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
			<span class="hljs-keyword">const</span> run = <span class="hljs-function">() =&gt;</span> &#123;
				<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._status === STATUS.PENDING) &#123;
					<span class="hljs-built_in">this</span>._status = STATUS.REJECTED;
					<span class="hljs-built_in">this</span>._value = value;
		
					<span class="hljs-keyword">while</span> (<span class="hljs-built_in">this</span>._rejectQueue.length) &#123;
						<span class="hljs-keyword">const</span> callback = <span class="hljs-built_in">this</span>._rejectQueue.shift();
						callback(value);
					&#125;
				&#125;
			&#125;
			<span class="hljs-built_in">setTimeout</span>(run);
		&#125;
	
		<span class="hljs-comment">// new Promise()时立即执行executor,并传入resolve和reject</span>
		executor(resolve, reject);
	&#125;
 
	<span class="hljs-comment">// then方法,接收一个成功的回调和一个失败的回调</span>
	<span class="hljs-function"><span class="hljs-title">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>)</span> &#123;
		<span class="hljs-comment">// 根据规范，如果then的参数不是function，则忽略它, 让值继续往下传递，链式调用继续往下执行</span>
		<span class="hljs-keyword">typeof</span> onFulfilled !== <span class="hljs-string">&#x27;function&#x27;</span> ? onFulfilled = <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> value : <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">typeof</span> onRejected !== <span class="hljs-string">&#x27;function&#x27;</span> ? onRejected = <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> error : <span class="hljs-literal">null</span>;
	
		<span class="hljs-comment">// then 返回一个新的promise</span>
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
			<span class="hljs-keyword">const</span> resolveFn = <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
				<span class="hljs-keyword">try</span> &#123;
					<span class="hljs-keyword">const</span> res = onFulfilled(value);
					<span class="hljs-comment">// 分类讨论返回值,如果是Promise,那么等待Promise状态变更,否则直接resolve</span>
					res <span class="hljs-keyword">instanceof</span> MyPromise ? res.then(resolve, reject) : resolve(res);
				&#125; <span class="hljs-keyword">catch</span> (error) &#123;
					reject(error);
				&#125;
			&#125;
	
			<span class="hljs-keyword">const</span> rejectFn = <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;
				<span class="hljs-keyword">try</span> &#123;
					<span class="hljs-keyword">const</span> res = onRejected(error);
					res <span class="hljs-keyword">instanceof</span> MyPromise ? res.then(resolve, reject) : resolve(res);
				&#125; <span class="hljs-keyword">catch</span> (error) &#123;
					reject(error);
				&#125;
			&#125;
	
			<span class="hljs-keyword">switch</span> (<span class="hljs-built_in">this</span>._status) &#123;
				<span class="hljs-keyword">case</span> STATUS.PENDING:
					<span class="hljs-built_in">this</span>._resolveQueue.push(resolveFn);
					<span class="hljs-built_in">this</span>._rejectQueue.push(rejectFn);
					<span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">case</span> STATUS.FULFILLED:
					resolveFn(<span class="hljs-built_in">this</span>._value);
					<span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">case</span> STATUS.REJECTED:
					rejectFn(<span class="hljs-built_in">this</span>._value);
					<span class="hljs-keyword">break</span>;
			&#125;
		&#125;)
	&#125;
 
	<span class="hljs-keyword">catch</span>(rejectFn) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.then(<span class="hljs-literal">undefined</span>, rejectFn);
	&#125;
 
	<span class="hljs-function"><span class="hljs-title">finally</span>(<span class="hljs-params">callback</span>)</span> &#123;
	  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> MyPromise.resolve(callback()).then(<span class="hljs-function">() =&gt;</span> value), <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;
			MyPromise.resolve(callback()).then(<span class="hljs-function">() =&gt;</span> error);
	  &#125;)
	&#125;
 
	<span class="hljs-comment">// 静态resolve方法</span>
	<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-title">resolve</span>(<span class="hljs-params">value</span>)</span> &#123;
		<span class="hljs-keyword">return</span> value <span class="hljs-keyword">instanceof</span> MyPromise ? value : <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> resolve(value));
	&#125;
 
	<span class="hljs-comment">// 静态reject方法</span>
	<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-title">reject</span>(<span class="hljs-params">error</span>)</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> reject(error));
	&#125;
 
	<span class="hljs-comment">// 静态all方法</span>
	<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-title">all</span>(<span class="hljs-params">promiseArr</span>)</span> &#123;
		<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
		<span class="hljs-keyword">let</span> result = [];
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
			<span class="hljs-keyword">if</span> (!promiseArr.length) &#123;
				<span class="hljs-keyword">return</span> resolve(result);
			&#125;
			promiseArr.forEach(<span class="hljs-function">(<span class="hljs-params">p, i</span>) =&gt;</span> &#123;
				MyPromise.resolve(p).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
					count++;
					result[i] = value;
					<span class="hljs-keyword">if</span> (count === promiseArr.length) &#123;
						resolve(result);
					&#125;
				&#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;
					reject(error);
				&#125;)
			&#125;)
		&#125;)
	&#125;
 
	<span class="hljs-comment">// 静态race方法</span>
	<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-title">race</span>(<span class="hljs-params">promiseArr</span>)</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
			promiseArr.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> &#123;
				MyPromise.resolve(p).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
					resolve(value);
				&#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;
					reject(error);
				&#125;)
			&#125;)
		&#125;)
	&#125;
&#125;</code></pre>

<pre><code class="hljs javaScript"><span class="hljs-built_in">Promise</span>.all = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">iterator</span>) </span>&#123;
	<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">let</span> res = [];
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i <span class="hljs-keyword">in</span> iterator)&#123;
			<span class="hljs-comment">// 先转化为Promise对象</span>
			<span class="hljs-built_in">Promise</span>.resolve(iterator[i]).then(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;
				res[i] = data;
				<span class="hljs-keyword">if</span>(++count === iterator.length)&#123;
					resolve(res);
				&#125;
			&#125;)
			.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
				reject(e);
			&#125;)
		&#125;
	&#125;)
&#125;

<span class="hljs-built_in">Promise</span>.all = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">iterators</span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">if</span> (!iterators || iterators.length === <span class="hljs-number">0</span>) &#123;
			resolve([]);
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>; <span class="hljs-comment">// 计数器，用于判断所有任务是否执行完成</span>
			<span class="hljs-keyword">let</span> result = []; <span class="hljs-comment">// 结果数组</span>
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterators.length; i++) &#123;
				<span class="hljs-comment">// 考虑到iterators[i]可能是普通对象，则统一包装为Promise对象</span>
				<span class="hljs-built_in">Promise</span>.resolve(iterators[i]).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;
						result[i] = data; <span class="hljs-comment">// 按顺序保存对应的结果</span>
						<span class="hljs-comment">// 当所有任务都执行完成后，再统一返回结果</span>
						<span class="hljs-keyword">if</span> (++count === iterators.length) &#123;
							resolve(result);
						&#125;
					&#125;, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
						reject(err); <span class="hljs-comment">// 任何一个Promise对象执行失败，则调用reject()方法</span>
						<span class="hljs-keyword">return</span>;
					&#125;
				);
			&#125;
		&#125;
	&#125;);
&#125;;

<span class="hljs-built_in">Promise</span>.race = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">iterators</span>) </span>&#123;  
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> p <span class="hljs-keyword">of</span> iterators) &#123;
			<span class="hljs-built_in">Promise</span>.resolve(p).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
				resolve(res)
			&#125;).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
				reject(e)
			&#125;)
		&#125;
	&#125;)
&#125;

<span class="hljs-comment">// 1 空数组或者所有 Promise 都是 rejected</span>
<span class="hljs-comment">// 	则返回状态是 rejected 的新 Promsie，且值为 AggregateError 的错误；</span>
<span class="hljs-comment">// 2 只要有一个是 fulfilled 状态的，则返回第一个是 fulfilled 的新实例；</span>
<span class="hljs-comment">// 3 其他情况都会返回一个 pending 的新实例</span>
<span class="hljs-built_in">Promise</span>.any = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promiseArr</span>) </span>&#123;
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (promiseArr.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> 
        promiseArr.forEach(<span class="hljs-function">(<span class="hljs-params">p, i</span>) =&gt;</span> &#123;
            <span class="hljs-built_in">Promise</span>.resolve(p).then(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> &#123;
                resolve(val)
                
            &#125;, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
                index++
                <span class="hljs-keyword">if</span> (index === promiseArr.length) &#123;
                  reject(<span class="hljs-keyword">new</span> AggregateError(<span class="hljs-string">&#x27;All promises were rejected&#x27;</span>))
                &#125;
            &#125;)
        &#125;)
    &#125;)
&#125;

<span class="hljs-comment">// 1 所有 Promise 的状态都变化了，那么新返回一个状态是 fulfilled 的 Promise</span>
<span class="hljs-comment">//   且它的值是一个数组，数组的每项由所有 Promise 的值和状态组成的对象；</span>
<span class="hljs-comment">// 2 如果有一个是 pending 的 Promise，则返回一个状态是 pending 的新实例；</span>
<span class="hljs-built_in">Promise</span>.allSettled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promiseArr</span>) </span>&#123;
	<span class="hljs-keyword">let</span> result = []
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
		promiseArr.forEach(<span class="hljs-function">(<span class="hljs-params">p, i</span>) =&gt;</span> &#123;
			<span class="hljs-built_in">Promise</span>.resolve(p).then(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> &#123;
					result.push(&#123;
						status: <span class="hljs-string">&#x27;fulfilled&#x27;</span>,
						value: val
					&#125;)
					<span class="hljs-keyword">if</span> (result.length === promiseArr.length) &#123;
						resolve(result) 
					&#125;
			&#125;, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
					result.push(&#123;
						status: <span class="hljs-string">&#x27;rejected&#x27;</span>,
						reason: err
					&#125;)
					<span class="hljs-keyword">if</span> (result.length === promiseArr.length) &#123;
						resolve(result) 
					&#125;
			&#125;)
		&#125;)  
	&#125;)   
&#125;

<span class="hljs-comment">// promise 串行</span>
<span class="hljs-comment">// create Promise</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createPromise</span>(<span class="hljs-params">time</span>) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span>&#123;
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>&#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;time in&#x27;</span> + time)
            resolve();
        &#125;, time * <span class="hljs-number">1000</span>)
    &#125;)
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iteratorPromise</span>(<span class="hljs-params">arr</span>) </span>&#123;
	arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, next, index, carr</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">return</span> pre.then(next)
	&#125;, <span class="hljs-built_in">Promise</span>.resolve())
&#125;

<span class="hljs-keyword">var</span> arr = [createPromise(<span class="hljs-number">1</span>), createPromise(<span class="hljs-number">3</span>), createPromise(<span class="hljs-number">2</span>), createPromise(<span class="hljs-number">4</span>)]
iteratorPromise(arr);</code></pre>

<h3 id="2-实现一个串行promise"><a href="#2-实现一个串行promise" class="headerlink" title="2 实现一个串行promise"></a>2 实现一个串行promise</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createPromise</span>(<span class="hljs-params">time</span>) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span>&#123;
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>&#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;time in&#x27;</span> + time)
            resolve();
        &#125;, time * <span class="hljs-number">1000</span>)
    &#125;)
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iteratorPromise</span>(<span class="hljs-params">arr</span>) </span>&#123;
	arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, next, index, carr</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">return</span> pre.then(next)
	&#125;, <span class="hljs-built_in">Promise</span>.resolve())
&#125;

<span class="hljs-keyword">var</span> arr = [createPromise(<span class="hljs-number">1</span>), createPromise(<span class="hljs-number">3</span>), createPromise(<span class="hljs-number">2</span>), createPromise(<span class="hljs-number">4</span>)]
iteratorPromise(arr);</code></pre>

<h3 id="3-promise-并发调度"><a href="#3-promise-并发调度" class="headerlink" title="3 promise 并发调度"></a>3 promise 并发调度</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 实现一个并发请求的函数</span>
<span class="hljs-keyword">var</span> jsonArr = [<span class="hljs-string">&#x27;api1.json&#x27;</span>, <span class="hljs-string">&#x27;api2.json&#x27;</span>, <span class="hljs-string">&#x27;api3.json&#x27;</span>, <span class="hljs-string">&#x27;api4.json&#x27;</span>, <span class="hljs-string">&#x27;api5.json&#x27;</span>, <span class="hljs-string">&#x27;api6.json&#x27;</span>]

fetchAll(jsonArr, <span class="hljs-number">2</span>).then(<span class="hljs-function">(<span class="hljs-params">[res1, res2, res3, res4, res5, res6]</span>) =&gt;</span> &#123;

&#125;)

<span class="hljs-comment">// 其中 jsonArr 为包含需要请求接口名的数组，limit 为最大并发请求数</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAll</span>(<span class="hljs-params">jsonArr, limit</span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;
		<span class="hljs-comment">// 结果</span>
		<span class="hljs-keyword">let</span> resList = [];
		<span class="hljs-comment">// 当前正在执行的并发任务队列</span>
		<span class="hljs-keyword">const</span> currPList = [];

		<span class="hljs-keyword">let</span> i = jsonArr.length - <span class="hljs-number">1</span>;
		<span class="hljs-comment">// 调度任务队列</span>
		<span class="hljs-keyword">const</span> fetcher = <span class="hljs-keyword">async</span> () =&gt; &#123;
			<span class="hljs-keyword">while</span>(jsonArr.length &gt; <span class="hljs-number">0</span>) &#123;
				<span class="hljs-keyword">let</span> j = i = i - <span class="hljs-number">1</span>;
				resList[j] = <span class="hljs-keyword">await</span> fetch(jsonArr.shift());
			&#125;
		&#125;

		<span class="hljs-comment">// 线程池</span>
		<span class="hljs-keyword">while</span>(limit) &#123;
			--limit;
			<span class="hljs-comment">// 控制当前并发调度队列只有2个</span>
			currPList.push(fetcher());
		&#125;
	
		<span class="hljs-comment">// 让2个并发队列同时执行</span>
		<span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all(currPList);
		resolve(resList);
	&#125;);
&#125;</code></pre>

<h3 id="4-JavaScript-并发调度"><a href="#4-JavaScript-并发调度" class="headerlink" title="4 JavaScript 并发调度"></a>4 JavaScript 并发调度</h3><p>该函数接收 3 个参数：</p>
<ul>
<li>poolLimit（数字类型）：表示限制的并发数；</li>
<li>array（数组类型）：表示任务数组；</li>
<li>iteratorFn（函数类型）：表示迭代函数，用于实现对每个任务项进行处理，该函数会返回一个 Promise 对象或异步函数。</li>
</ul>
<pre><code class="hljs javaScript"><span class="hljs-comment">// ES6 版本实现</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asyncPool</span>(<span class="hljs-params">poolLimit, array, iteratorFn</span>) </span>&#123;
	<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">const</span> ret = []; <span class="hljs-comment">// 存储所有的异步任务</span>
	<span class="hljs-keyword">const</span> executing = []; <span class="hljs-comment">// 存储正在执行的异步任务</span>
	<span class="hljs-keyword">const</span> enqueue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
		<span class="hljs-keyword">if</span> (i === array.length) &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve();
		&#125;
		<span class="hljs-keyword">const</span> item = array[i++]; <span class="hljs-comment">// 获取新的任务项</span>
		<span class="hljs-keyword">const</span> p = <span class="hljs-built_in">Promise</span>.resolve().then(<span class="hljs-function">() =&gt;</span> iteratorFn(item, array));
		ret.push(p);

		<span class="hljs-keyword">let</span> r = <span class="hljs-built_in">Promise</span>.resolve();

		<span class="hljs-comment">// 当poolLimit值小于或等于总任务个数时，进行并发控制</span>
		<span class="hljs-keyword">if</span> (poolLimit &lt;= array.length) &#123;
			<span class="hljs-comment">// 当任务完成后，从正在执行的任务数组中移除已完成的任务</span>
			<span class="hljs-keyword">const</span> e = p.then(<span class="hljs-function">() =&gt;</span> executing.splice(executing.indexOf(e), <span class="hljs-number">1</span>));
			executing.push(e);
			<span class="hljs-keyword">if</span> (executing.length &gt;= poolLimit) &#123;
				r = <span class="hljs-built_in">Promise</span>.race(executing); 
			&#125;
		&#125;
	
		<span class="hljs-comment">// 正在执行任务列表 中较快的任务执行完成之后，才会从array数组中获取新的待办任务</span>
		<span class="hljs-keyword">return</span> r.then(<span class="hljs-function">() =&gt;</span> enqueue());
	&#125;;
	<span class="hljs-keyword">return</span> enqueue().then(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Promise</span>.all(ret));
&#125;

<span class="hljs-comment">// ES7 版本实现</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asyncPool</span>(<span class="hljs-params">poolLimit, array, iteratorFn</span>) </span>&#123;
	<span class="hljs-keyword">const</span> ret = []; <span class="hljs-comment">// 存储所有的异步任务</span>
	<span class="hljs-keyword">const</span> executing = []; <span class="hljs-comment">// 存储正在执行的异步任务</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> array) &#123;
		<span class="hljs-comment">// 调用iteratorFn函数创建异步任务</span>
		<span class="hljs-keyword">const</span> p = <span class="hljs-built_in">Promise</span>.resolve().then(<span class="hljs-function">() =&gt;</span> iteratorFn(item, array));
		ret.push(p); <span class="hljs-comment">// 保存新的异步任务</span>

		<span class="hljs-comment">// 当poolLimit值小于或等于总任务个数时，进行并发控制</span>
		<span class="hljs-keyword">if</span> (poolLimit &lt;= array.length) &#123;
			<span class="hljs-comment">// 当任务完成后，从正在执行的任务数组中移除已完成的任务</span>
			<span class="hljs-keyword">const</span> e = p.then(<span class="hljs-function">() =&gt;</span> executing.splice(executing.indexOf(e), <span class="hljs-number">1</span>));
			executing.push(e); <span class="hljs-comment">// 保存正在执行的异步任务</span>
			<span class="hljs-keyword">if</span> (executing.length &gt;= poolLimit) &#123;
				<span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.race(executing); <span class="hljs-comment">// 等待较快的任务执行完成</span>
			&#125;
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(ret);
&#125;</code></pre>

<h3 id="5-简易版generator"><a href="#5-简易版generator" class="headerlink" title="5 简易版generator"></a>5 简易版generator</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myGenerator</span>(<span class="hljs-params">list</span>) </span>&#123;
	<span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">var</span> len = list.length;
	<span class="hljs-keyword">return</span> &#123;
		next: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
			<span class="hljs-keyword">var</span> done = index &gt;= len;
			<span class="hljs-keyword">var</span> value = !done ? list[index++] : <span class="hljs-literal">undefined</span>; 
			<span class="hljs-keyword">return</span> &#123;
				done: done,
				value: value
			&#125;
		&#125;
	&#125;
&#125;

<span class="hljs-keyword">var</span> gen = myGenerator([<span class="hljs-string">&#x27;大罗&#x27;</span>, <span class="hljs-string">&#x27;小罗&#x27;</span>, <span class="hljs-string">&#x27;C罗&#x27;</span>]);
gen.next(); <span class="hljs-comment">// &#123;done: false, value: &quot;大罗&quot;&#125;</span>
gen.next(); <span class="hljs-comment">// &#123;done: false, value: &quot;小罗&quot;&#125;</span>
gen.next(); <span class="hljs-comment">// &#123;done: false, value: &quot;C罗&quot;&#125;</span>
gen.next(); <span class="hljs-comment">// &#123;done: true, value: undefined&#125;</span></code></pre>

<h3 id="6-用-setTimeout-模拟-setInterval"><a href="#6-用-setTimeout-模拟-setInterval" class="headerlink" title="6 用 setTimeout 模拟 setInterval"></a>6 用 setTimeout 模拟 setInterval</h3><p>题目：用 setTimeout 函数 模拟 setInterval</p>
<p>前置条件：</p>
<ol>
<li>假设 setTimeout 里执行的目标函数返回的是一个 Promise</li>
<li>假设 interval 的值为 3000, 单位为 ms</li>
</ol>
<p>要求：</p>
<ol>
<li>不能使用 setInterval 函数</li>
<li>调用 mockInterval 函数时，确保能够立即执行一次目标函数，无需等待 3000ms</li>
<li>当 Promise 执行的时间小于 3000ms 时，需要确保过了 3000ms 之后才能执行下一次 callback</li>
<li>当 Promise 执行的时间超出 3000ms 时，需要等待 Promise 执行完成，才能走回想下一次 callBack </li>
</ol>
<pre><code class="hljs javaScript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mockInterval</span>(<span class="hljs-params">callBack, time=<span class="hljs-number">3000</span></span>) </span>&#123;
	<span class="hljs-comment">// 为了防止传入的 callBack 是一个异步函数</span>
	<span class="hljs-keyword">await</span> callBack();
	setIntervalFn(callBack, time);
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setIntervalFn</span>(<span class="hljs-params">callBack, time</span>) </span>&#123;
	<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params">resolve</span>)</span>&#123;
			<span class="hljs-comment">// 为了防止传入的 callBack 是一个异步函数</span>
			<span class="hljs-keyword">await</span> callBack();
			setIntervalFn(callBack, time);
		&#125;)
	&#125;, time)
&#125;

<span class="hljs-comment">// test</span>
mockInterval(<span class="hljs-function">() =&gt;</span> &#123;
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;call Back fn&#x27;</span>);
&#125;, <span class="hljs-number">3000</span>)</code></pre>

<h2 id="五-函数-数组"><a href="#五-函数-数组" class="headerlink" title="五 函数/数组"></a>五 函数/数组</h2><p>1 函数柯里化<br>2 偏函数<br>3 compose 函数<br>4 LRU 函数<br>5 loadsh -&gt; get<br>6 sleep函数<br>7 数组随机打乱<br>8 数组扁平化<br>9 Array.prototype.fill<br>10 Array.prototype.map<br>11 Array.prototype.reduce<br>12 Array.prototype.forEach<br>13 Array.prototype.filter<br>14 Array.prototype.some<br>15 两数相加<br>16 两数相减<br>17 两数相乘<br>18 两数相除<br>19 Math.pow()</p>
<h3 id="1-函数柯里化"><a href="#1-函数柯里化" class="headerlink" title="1 函数柯里化"></a>1 函数柯里化</h3><p>函数柯里化是把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。</p>
<pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b, c</span>) </span>&#123;
    <span class="hljs-keyword">return</span> a + b + c
&#125;
add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
<span class="hljs-keyword">let</span> addCurry = curry(add)
addCurry(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)

<span class="hljs-comment">// 现在就是要实现 curry 这个函数</span>
<span class="hljs-comment">// 使函数从一次调用传入多个参数变成多次调用每次传一个参数。</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curry</span>(<span class="hljs-params">fn</span>) </span>&#123;
	<span class="hljs-keyword">let</span> judge = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">if</span> (args.length == fn.length) <span class="hljs-keyword">return</span> fn(...args)
		<span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...arg</span>) =&gt;</span> judge(...args, ...arg)
	&#125;
	<span class="hljs-keyword">return</span> judge
&#125;

<span class="hljs-comment">// 函数柯里化</span>
<span class="hljs-keyword">const</span> curry = <span class="hljs-function">(<span class="hljs-params">fn, ...args</span>) =&gt;</span>
	args.length &lt; fn.length
		<span class="hljs-comment">//参数长度不足时，重新柯里化该函数，等待接受新参数</span>
		? <span class="hljs-function">(<span class="hljs-params">...<span class="hljs-built_in">arguments</span></span>) =&gt;</span> curry(fn, ...args, ...arguments)
		<span class="hljs-comment">//参数长度满足时，执行函数</span>
		: fn(...args);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sumFn</span>(<span class="hljs-params">a, b, c</span>) </span>&#123;
	<span class="hljs-keyword">return</span> a + b + c;
&#125;
<span class="hljs-keyword">var</span> sum = curry(sumFn);
<span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)(<span class="hljs-number">5</span>));<span class="hljs-comment">//10</span>
<span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>));<span class="hljs-comment">//10</span>
<span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>));<span class="hljs-comment">//10</span>
<span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)(<span class="hljs-number">5</span>));<span class="hljs-comment">//10</span></code></pre>

<h3 id="2-偏函数"><a href="#2-偏函数" class="headerlink" title="2 偏函数"></a>2 偏函数</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 偏函数就是将一个 n 参的函数转换成固定 x 参的函数</span>
<span class="hljs-comment">// 剩余参数（n - x）将在下次调用全部传入</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b, c</span>) </span>&#123;
    <span class="hljs-keyword">return</span> a + b + c
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">partial</span>(<span class="hljs-params">fn, ...args</span>) </span>&#123;
	<span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...arg</span>) =&gt;</span> &#123;
		<span class="hljs-keyword">return</span> fn(...args, ...arg)
	&#125;
&#125;
<span class="hljs-keyword">let</span> partialAdd = partial(add, <span class="hljs-number">1</span>)
partialAdd(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)</code></pre>

<h3 id="3-手写-compose-函数"><a href="#3-手写-compose-函数" class="headerlink" title="3 手写 compose 函数"></a>3 手写 compose 函数</h3><p>compose就是执行一系列的任务（函数），比如有以下任务队列，</p>
<p><code>let tasks = [step1, step2, step3, step4]</code><br>每一个step都是一个步骤，按照步骤一步一步的执行到结尾，这就是一个compose<br>compose在函数式编程中是一个很重要的工具函数，在这里实现的compose有三点说明</p>
<p>1 第一个函数是多元的（接受多个参数），后面的函数都是单元的（接受一个参数）<br>2 执行顺序的自右向左的<br>3 所有函数的执行都是同步的（异步的后面文章会讲到）</p>
<p>例如<br>let init = (…args) =&gt; args.reduce((ele1, ele2) =&gt; ele1 + ele2, 0)<br>let step2 = (val) =&gt; val + 2<br>let step3 = (val) =&gt; val + 3<br>let step4 = (val) =&gt; val + 4</p>
<p>pipe 函数与 compose函数的共同点是都返回“组合函数”，区别则是执行的顺序不同，前者是从左向右执行，后者则是从右向左执行。 实现 pipe函数非常简单，只需要对 compose 函数的包裹顺序进行调整一下即可。</p>
<pre><code class="hljs javaScript"><span class="hljs-comment">// 解法一 面向过程</span>
<span class="hljs-keyword">const</span> compose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>&#123;
	<span class="hljs-keyword">let</span> length = args.length
	<span class="hljs-keyword">let</span> count = length - <span class="hljs-number">1</span>
	<span class="hljs-keyword">let</span> result
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f1</span> (<span class="hljs-params">...arg1</span>) </span>&#123;
		result = args[count].apply(<span class="hljs-built_in">this</span>, arg1)
		<span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">0</span>) &#123;
			count = length - <span class="hljs-number">1</span>
			<span class="hljs-keyword">return</span> result
		&#125;
		count--
		<span class="hljs-keyword">return</span> f1.call(<span class="hljs-literal">null</span>, result)
	&#125;
&#125;

<span class="hljs-comment">// 解法二</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compose</span>(<span class="hljs-params">...funcs</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (funcs.length === <span class="hljs-number">0</span>) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">arg</span> =&gt;</span> arg;
	&#125;
	<span class="hljs-keyword">if</span> (funcs.length === <span class="hljs-number">1</span>) &#123;
		<span class="hljs-keyword">return</span> funcs[<span class="hljs-number">0</span>];
	&#125;
	<span class="hljs-keyword">return</span> funcs.reduce(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> a(b(...args)));
&#125;

<span class="hljs-keyword">const</span> compose = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> args.reduceRight(<span class="hljs-function">(<span class="hljs-params">res, cb</span>) =&gt;</span> cb(res), x);
<span class="hljs-keyword">const</span> pipe = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> args.reduce(<span class="hljs-function">(<span class="hljs-params">res, cb</span>) =&gt;</span> cb(res), x)


<span class="hljs-comment">// 解法三 promise</span>
<span class="hljs-keyword">const</span> compose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>&#123;
	<span class="hljs-keyword">let</span> init = args.pop()
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...arg</span>) </span>&#123;
		<span class="hljs-keyword">return</span> args.reverse().reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sequence, func</span>) </span>&#123;
			<span class="hljs-keyword">return</span> sequence.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>&#123;
				<span class="hljs-keyword">return</span> func.call(<span class="hljs-literal">null</span>, result)
			&#125;)
		&#125;, <span class="hljs-built_in">Promise</span>.resolve(init.apply(<span class="hljs-literal">null</span>, arg)))
	&#125;
&#125;

<span class="hljs-comment">// 解法三 Generator</span>

<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">iterateSteps</span>(<span class="hljs-params">steps</span>) </span>&#123;
	<span class="hljs-keyword">let</span> n
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; steps.length; i++) &#123;
		<span class="hljs-keyword">if</span> (n) &#123;
			n = <span class="hljs-keyword">yield</span> steps[i].call(<span class="hljs-literal">null</span>, n)
		&#125; <span class="hljs-keyword">else</span> &#123;
			n = <span class="hljs-keyword">yield</span>
		&#125;
	&#125;
&#125;
<span class="hljs-keyword">const</span> compose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...steps</span>) </span>&#123;
	<span class="hljs-keyword">let</span> g = iterateSteps(steps)
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>&#123;
		<span class="hljs-keyword">let</span> val = steps.pop().apply(<span class="hljs-literal">null</span>, args)
		<span class="hljs-comment">// 这里是第一个值</span>
		<span class="hljs-built_in">console</span>.log(val)
		<span class="hljs-comment">// 因为无法传参数 所以无所谓执行 就是空耗一个yield</span>
		g.next()
		<span class="hljs-keyword">return</span> steps.reverse.reduce(<span class="hljs-function">(<span class="hljs-params">val, val1</span>) =&gt;</span> g.next(val).value, val)
  &#125;
&#125;

<span class="hljs-comment">// 解法四</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compose</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">var</span> fns = [].slice.call(<span class="hljs-built_in">arguments</span>)
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">initialArg</span>) </span>&#123;
		<span class="hljs-keyword">var</span> res = initialArg
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = fns.length - <span class="hljs-number">1</span>; i &gt; -<span class="hljs-number">1</span>; i--) &#123;
			res = fns[i](res);
		&#125;
		<span class="hljs-keyword">return</span> res
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pipe</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">var</span> fns = [].slice.call(<span class="hljs-built_in">arguments</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">initialAgr</span>) </span>&#123;
        <span class="hljs-keyword">var</span> res = initialAgr
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fns.length; i++) &#123;
            res = fns[i](res)
        &#125;
        <span class="hljs-keyword">return</span> res
    &#125;
&#125;

<span class="hljs-keyword">var</span> greet = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hi:&#x27;</span> + name &#125;
<span class="hljs-keyword">var</span> exclaim = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">statement</span>) </span>&#123; <span class="hljs-keyword">return</span> statement.toUpperCase() + <span class="hljs-string">&#x27;!&#x27;</span> &#125;
<span class="hljs-keyword">var</span> transform = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) </span>&#123; <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/[dD]/</span>, <span class="hljs-string">&#x27;DDDDD&#x27;</span>) &#125;
<span class="hljs-keyword">var</span> welcome1 = compose(greet, exclaim, transform)
<span class="hljs-keyword">var</span> welcome2 = pipe(greet, exclaim, transform)
<span class="hljs-built_in">console</span>.log(welcome1(<span class="hljs-string">&#x27;dot&#x27;</span>))<span class="hljs-comment">//hi:DDDDDOT!</span>
<span class="hljs-built_in">console</span>.log(welcome2(<span class="hljs-string">&#x27;dolb&#x27;</span>))<span class="hljs-comment">//HI:DDDDDOLB!</span>
</code></pre>

<h3 id="4-手写-LRU-函数"><a href="#4-手写-LRU-函数" class="headerlink" title="4 手写 LRU 函数"></a>4 手写 LRU 函数</h3><p>运用你所掌握的数据结构，设计和实现一个  LRU (最近最少使用) 缓存机制 。<br>实现 LRUCache 类：</p>
<p>1 LRUCache(int capacity) 以正整数作为容量 capacity 初始化 LRU 缓存<br>2 int get(int key) 如果关键字 key 存在于缓存中，则返回关键字的值，否则返回 -1 。<br>3 void put(int key, int value) 如果关键字已经存在，则变更其数据值；<br>    如果关键字不存在，则插入该组「关键字-值」。当缓存容量达到上限时，<br>    它应该在写入新数据之前删除最久未使用的数据值，从而为新的数据值留出空间。</p>
<p>进阶：你是否可以在 O(1) 时间复杂度内完成这两种操作？</p>
<pre><code class="hljs text">输入
[&quot;LRUCache&quot;, &quot;put&quot;, &quot;put&quot;, &quot;get&quot;, &quot;put&quot;, &quot;get&quot;, &quot;put&quot;, &quot;get&quot;, &quot;get&quot;, &quot;get&quot;]
[[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]
输出
[null, null, null, 1, null, -1, null, -1, 3, 4]

解释
LRUCache lRUCache = new LRUCache(2);
lRUCache.put(1, 1); // 缓存是 &#123;1=1&#125;
lRUCache.put(2, 2); // 缓存是 &#123;1=1, 2=2&#125;
lRUCache.get(1);    // 返回 1
lRUCache.put(3, 3); // 该操作会使得关键字 2 作废，缓存是 &#123;1=1, 3=3&#125;
lRUCache.get(2);    // 返回 -1 (未找到)
lRUCache.put(4, 4); // 该操作会使得关键字 1 作废，缓存是 &#123;4=4, 3=3&#125;
lRUCache.get(1);    // 返回 -1 (未找到)
lRUCache.get(3);    // 返回 3
lRUCache.get(4);    // 返回 4</code></pre>

<pre><code class="hljs javaScript"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;number&#125;</span> <span class="hljs-variable">capacity</span></span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LRUCache</span> </span>&#123;
	<span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">capacity</span>)</span> &#123;
		<span class="hljs-built_in">this</span>.capacity = capacity
		<span class="hljs-built_in">this</span>.map = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>();
	&#125;

	<span class="hljs-function"><span class="hljs-title">get</span>(<span class="hljs-params">key</span>)</span> &#123;
		<span class="hljs-keyword">let</span> val = <span class="hljs-built_in">this</span>.map.get(key);
		<span class="hljs-keyword">if</span> (val === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;

		<span class="hljs-built_in">this</span>.map.delete(key); <span class="hljs-comment">// 因为被用过一次，原有位置删除</span>
		<span class="hljs-built_in">this</span>.map.set(key, val); <span class="hljs-comment">// 放入最下面表示最新使用</span>
		<span class="hljs-keyword">return</span> val;
	&#125;

	<span class="hljs-function"><span class="hljs-title">put</span>(<span class="hljs-params">key, val</span>)</span> &#123;
		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.map.has(key)) <span class="hljs-built_in">this</span>.map.delete(key); <span class="hljs-comment">// 如果有，删除</span>

		<span class="hljs-built_in">this</span>.map.set(key, val); <span class="hljs-comment">// 放到最下面表示最新使用</span>

		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.map.size &gt; <span class="hljs-built_in">this</span>.capacity) &#123;
			<span class="hljs-comment">// 这里有个知识点</span>
			<span class="hljs-comment">// map的entries方法，还有keys方法(可以看mdn))，会返回一个迭代器</span>
			<span class="hljs-comment">// 迭代器调用next也是顺序返回，所以返回第一个的值就是最老的，找到并删除即可</span>
			<span class="hljs-built_in">this</span>.map.delete(<span class="hljs-built_in">this</span>.map.entries().next().value[<span class="hljs-number">0</span>])
		&#125;
	&#125;
&#125;</code></pre>

<h3 id="5-loadsh-gt-get"><a href="#5-loadsh-gt-get" class="headerlink" title="5 loadsh -&gt; get"></a>5 loadsh -&gt; get</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 题目描述</span>
	<span class="hljs-keyword">var</span> obj = &#123;
		selector: &#123; 
			to: &#123; 
				toutiao: <span class="hljs-string">&#x27;FE coder&#x27;</span> 
			&#125; 
		&#125;,
		target: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;byted&#x27;</span> &#125;] 
	&#125;;
	<span class="hljs-comment">// 运行代码</span>
	<span class="hljs-keyword">var</span> res = getValsByKeys(obj, <span class="hljs-string">&#x27;selector.to.toutiao&#x27;</span>, <span class="hljs-string">&#x27;selector.feishu.toutiao&#x27;</span>, <span class="hljs-string">&#x27;target[0]&#x27;</span>, <span class="hljs-string">&#x27;target[2].name&#x27;</span>, <span class="hljs-string">&#x27;select.to.douyin&#x27;</span>)
	<span class="hljs-built_in">console</span>.log(res);
	<span class="hljs-comment">//  输出结果</span>
	<span class="hljs-comment">// [&#x27;FE coder&#x27;, &#x27;&#x27;,  1, &#x27;byted&#x27;, &#x27;&#x27;]</span>

<span class="hljs-comment">// 解答：</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getValsByKeys</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &lt; <span class="hljs-number">2</span>) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;arguments error&#x27;</span>);
	&#125;
	<span class="hljs-keyword">const</span> [obj, ...args] = [...arguments];
	<span class="hljs-keyword">const</span> res = [];
	args.forEach(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;
		key = key.replaceAll(<span class="hljs-string">&#x27;[&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>).replaceAll(<span class="hljs-string">&#x27;]&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>);
		res.push(getValByKey(obj, key));
	&#125;);
	<span class="hljs-keyword">return</span> res;
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getValByKey</span>(<span class="hljs-params">obj, key</span>) </span>&#123;
	<span class="hljs-keyword">const</span> arr = key.split(<span class="hljs-string">&#x27;.&#x27;</span>);
	<span class="hljs-keyword">if</span> (arr.length &gt; <span class="hljs-number">1</span>) &#123;
		<span class="hljs-keyword">return</span> obj[arr[<span class="hljs-number">0</span>]] ? getValByKey(obj[arr[<span class="hljs-number">0</span>]], arr.slice(<span class="hljs-number">1</span>).join(<span class="hljs-string">&#x27;.&#x27;</span>)) : <span class="hljs-string">&#x27;&#x27;</span>;
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">return</span> obj[key] ? obj[key] : <span class="hljs-string">&#x27;&#x27;</span>;
	&#125;
&#125;</code></pre>

<h3 id="6-sleep函数"><a href="#6-sleep函数" class="headerlink" title="6 sleep函数"></a>6 sleep函数</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sleep</span>(<span class="hljs-params">delay</span>) </span>&#123;
	<span class="hljs-keyword">var</span> start = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime();
	<span class="hljs-keyword">while</span> ((<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime() - start &lt; delay) &#123;
		<span class="hljs-keyword">continue</span>;
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;111&#x27;</span>);
  sleep(<span class="hljs-number">2000</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;222&#x27;</span>);
&#125;

test()</code></pre>

<h3 id="7-数组随机打乱"><a href="#7-数组随机打乱" class="headerlink" title="7 数组随机打乱"></a>7 数组随机打乱</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randArr</span>(<span class="hljs-params">arr</span>)</span>&#123;
	<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">Array</span>.isArray(arr)) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;type error&#x27;</span>);
	&#125;
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;
		<span class="hljs-keyword">const</span> randIndex = <span class="hljs-built_in">Math</span>.floor(arr.length * <span class="hljs-built_in">Math</span>.random());
		<span class="hljs-keyword">if</span> (i !== randIndex) &#123;
			[arr[i], arr[randIndex]] = [arr[randIndex], arr[i]];
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> arr;
&#125;</code></pre>

<h3 id="8-数组扁平化"><a href="#8-数组扁平化" class="headerlink" title="8 数组扁平化"></a>8 数组扁平化</h3><p>ES6 为数组实例新增了 flat 方法 用于将数组扁平化。<br><code>var newArray = arr.flat(Infinity)</code></p>
<pre><code class="hljs javaScript"><span class="hljs-comment">// 手动实现 一个 flat函数：</span>
<span class="hljs-comment">// 方式一: ES6 递归 —— reduce</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flatArray</span>(<span class="hljs-params">arr</span>) </span>&#123;
	<span class="hljs-keyword">return</span> arr.reduce(<span class="hljs-function">(<span class="hljs-params">acc, val</span>) =&gt;</span> 
		<span class="hljs-built_in">Array</span>.isArray(val) ? 
			acc.concat(flatArray(val)) : acc.concat(val), [])
&#125;

<span class="hljs-comment">// 方式二: 利用栈(stack) </span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flatArray</span>(<span class="hljs-params">arr</span>) </span>&#123;
	<span class="hljs-keyword">const</span> stack = [...arr];
	<span class="hljs-keyword">const</span> newArr = [];
	<span class="hljs-keyword">while</span> (stack.length) &#123;
		<span class="hljs-keyword">const</span> item = stack.pop();
		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(item)) &#123;
			stack.push(...item);
		&#125; <span class="hljs-keyword">else</span> &#123;
			newArr.unshift(item);
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> newArr;
&#125;

<span class="hljs-comment">// 方法三: ES5 递归</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flatArray</span>(<span class="hljs-params">arr</span>) </span>&#123;
	<span class="hljs-keyword">var</span> result = [];
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = arr.length; i &lt; len; i++) &#123;
		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(arr[i])) &#123;
				result = result.concat(flatArray(arr[i]))
				<span class="hljs-comment">// result = [...result, ...flatArray(arr[i])];</span>
		&#125; <span class="hljs-keyword">else</span> &#123;
				result.push(arr[i])
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> result;
&#125;</code></pre>

<h3 id="9-Array-fill"><a href="#9-Array-fill" class="headerlink" title="9 Array.fill"></a>9 Array.fill</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// arr.fill(value [,start [,end]])</span>
<span class="hljs-built_in">Array</span>.prototype.myFill = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val, start = <span class="hljs-number">0</span>, end = <span class="hljs-built_in">this</span>.length</span>)</span>&#123;
	<span class="hljs-keyword">if</span> (start &lt; end) &#123;
		<span class="hljs-built_in">this</span>[start] = val;
		<span class="hljs-built_in">this</span>.myFill(val, start + <span class="hljs-number">1</span>, end)
	&#125;
&#125;

<span class="hljs-built_in">Array</span>.prototype.myFill2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val, start = <span class="hljs-number">0</span>, end = <span class="hljs-built_in">this</span>.length</span>) </span>&#123;
	<span class="hljs-keyword">while</span> (start &lt; end) &#123;
		<span class="hljs-built_in">this</span>[start] = val;
		start++;
	&#125;
&#125;</code></pre>

<h3 id="10-Array-map"><a href="#10-Array-map" class="headerlink" title="10 Array.map"></a>10 Array.map</h3><p>核心要点:<br>1.回调函数的参数有哪些，返回值如何处理。<br>2.不修改原来的数组。</p>
<pre><code class="hljs javaScript"><span class="hljs-comment">/*</span>
<span class="hljs-comment">var new_array = arr.map(function callback(currentValue[, index[, array]]) &#123;</span>
<span class="hljs-comment">	Return element for new_array </span>
<span class="hljs-comment">&#125;[, thisArg])</span>
<span class="hljs-comment">callback - 生成新数组元素的函数，使用三个参数 currentValue, index(可选), array(可选)</span>
<span class="hljs-comment">thisArg - 执行 callback 函数时值被用作this</span>
<span class="hljs-comment">*/</span>
<span class="hljs-built_in">Array</span>.prototype.MyMap = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn, thisArg</span>)</span>&#123;
	<span class="hljs-keyword">var</span> arr = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">this</span>);<span class="hljs-comment">//由于是ES5所以就不用...展开符了</span>
	<span class="hljs-keyword">var</span> mappedArr = [];
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++ )&#123;
		mappedArr.push(fn.call(thisArg, arr[i], i, <span class="hljs-built_in">this</span>));
	&#125;
	<span class="hljs-keyword">return</span> mappedArr;
&#125;</code></pre>

<h3 id="11-Array-reduce"><a href="#11-Array-reduce" class="headerlink" title="11 Array.reduce"></a>11 Array.reduce</h3><p>核心要点:<br>1、初始值不传怎么处理<br>2、回调函数的参数有哪些，返回值如何处理。</p>
<pre><code class="hljs javaScript"><span class="hljs-comment">// arr.reduce(callback(accumulator, currentValue [,index [,array]])  [,initialValue])</span>

<span class="hljs-comment">// 简单版本</span>
<span class="hljs-built_in">Array</span>.prototype.myReduce = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn, initialValue</span>) </span>&#123;
	<span class="hljs-comment">// 判断调用对象是否为数组</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.prototype.toString.call(<span class="hljs-built_in">this</span>) !== <span class="hljs-string">&#x27;[object Array]&#x27;</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;not a array&#x27;</span>);
	&#125;
	<span class="hljs-comment">// 判断传入的第一个参数是否为函数</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">&#x27;function&#x27;</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;fn&#125;</span> is not a function`</span>);
	&#125;
	<span class="hljs-comment">// 判断调用数组是否为空数组</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.length === <span class="hljs-number">0</span>) &#123;
		<span class="hljs-keyword">if</span> (initialValue) &#123;
			<span class="hljs-keyword">return</span> initialValue;
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;empty array&#x27;</span>);
		&#125;
	&#125;
	<span class="hljs-keyword">const</span> arr = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">this</span>);
	<span class="hljs-keyword">const</span> startIndex = initialValue ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;
	<span class="hljs-keyword">let</span> res = initialValue ? initialValue : arr[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = startIndex; i &lt; arr.length; i++) &#123;
		res = fn.call(<span class="hljs-literal">null</span>, res, arr[i], i, <span class="hljs-built_in">this</span>);
	&#125;
	<span class="hljs-keyword">return</span> res;
&#125;

<span class="hljs-built_in">Array</span>.prototype.myReduceRight = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn, initialValue</span>) </span>&#123;
	<span class="hljs-keyword">const</span> arr = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">this</span>);
	<span class="hljs-keyword">let</span> startIndex = initialValue ? arr.length - <span class="hljs-number">1</span> : arr.length - <span class="hljs-number">2</span>;
	<span class="hljs-keyword">let</span> res = initialValue ? initialValue : arr[arr.length - <span class="hljs-number">1</span>];
	<span class="hljs-keyword">while</span>(startIndex &gt; -<span class="hljs-number">1</span>) &#123;
		res = fn.call(<span class="hljs-literal">null</span>, res, arr[startIndex], startIndex, <span class="hljs-built_in">this</span>);
		startIndex--;
	&#125;
	<span class="hljs-keyword">return</span> res;
&#125;

<span class="hljs-comment">// 完美版本</span>

<span class="hljs-comment">// 思路</span>
<span class="hljs-comment">// 1 常规判断 这里我们主要要判断的是调用数组、传入参数</span>
<span class="hljs-comment">// 2 初始化各个变量，为第一次执行函数做准备</span>
<span class="hljs-comment">// 	这里我们需要准备的变量有需要传入回调函数的4个参数</span>
<span class="hljs-comment">// 	callback的4个参数: accumulator, currentValue, currentIndex, sourceArray</span>
<span class="hljs-comment">// 		accumulator: 累计器累计回调的返回值; 它是上一次调用回调时返回的累积值，或initialValue</span>
<span class="hljs-comment">// 		currentValue: 数组中正在处理的元素</span>
<span class="hljs-comment">//			currentIndex(可选): 数组中正在处理的当前元素的索引.如果提供了initialValue，则起始索引号为0，否则从索引1起始</span>
<span class="hljs-comment">//			sourceArray(可选): 调用reduce()的数组</span>
<span class="hljs-comment">//		initialValue(可选): 作为第一次调用 callback函数时的第一个参数的值.如果没有提供初始值，则将使用数组中的第一个元素.在没有初始值的空数组上调用 reduce 将报错</span>
<span class="hljs-comment">// 3 开始循环 同时记得更新几个参数和返回结果</span>
<span class="hljs-comment">// 4 返回结果</span>
<span class="hljs-built_in">Array</span>.prototype.myreduce = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn, initialValue</span>) </span>&#123;
	<span class="hljs-comment">// 判断调用对象是否为数组</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.prototype.toString.call(<span class="hljs-built_in">this</span>) !== <span class="hljs-string">&#x27;[object Array]&#x27;</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;not a array&#x27;</span>);
	&#125;
	<span class="hljs-comment">// 判断调用数组是否为空数组</span>
	<span class="hljs-keyword">const</span> sourceArray = <span class="hljs-built_in">this</span>;
	<span class="hljs-keyword">if</span> (sourceArray.length === <span class="hljs-number">0</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;empty array&#x27;</span>);
	&#125;
	<span class="hljs-comment">// 判断传入的第一个参数是否为函数</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">&#x27;function&#x27;</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;fn&#125;</span> is not a function`</span>);
	&#125;

	<span class="hljs-comment">// 第二步 回调函数参数初始化</span>
	<span class="hljs-keyword">let</span> accumulator;
	<span class="hljs-keyword">let</span> currentValue;
	<span class="hljs-keyword">let</span> currentIndex;
	<span class="hljs-keyword">if</span> (initialValue) &#123;
		accumulator = initialValue;
		currentIndex = <span class="hljs-number">0</span>;
	&#125; <span class="hljs-keyword">else</span> &#123;
		accumulator = arr[<span class="hljs-number">0</span>];
		currentIndex = <span class="hljs-number">1</span>;
	&#125;

	<span class="hljs-comment">// 第三步 开始循环</span>
	<span class="hljs-keyword">while</span> (currentIndex &lt; sourceArray.length) &#123;
		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(sourceArray, currentIndex)) &#123;
			currentValue = sourceArray[currentIndex];
			accumulator = fn(accumulator, currentValue, currentIndex, sourceArray);
		&#125;
		currentIndex++;
	&#125;

	<span class="hljs-comment">// 第四步 返回结果</span>
	<span class="hljs-keyword">return</span> accumulator;
&#125;

<span class="hljs-comment">// test</span>
<span class="hljs-keyword">const</span> rReduce = [<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>, , <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].reduce(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">3</span>)
<span class="hljs-keyword">const</span> mReduce = [<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>, , <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].myreduce(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">3</span>)

<span class="hljs-built_in">console</span>.log(rReduce); <span class="hljs-comment">// 31nullundefined34</span>
<span class="hljs-built_in">console</span>.log(mReduce); <span class="hljs-comment">// 31nullundefined34</span></code></pre>

<h3 id="12-Array-forEach"><a href="#12-Array-forEach" class="headerlink" title="12 Array.forEach"></a>12 Array.forEach</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// arr.forEach(callback(currentValue [,index [,array]])  [,thisArg])</span>
<span class="hljs-built_in">Array</span>.prototype.forEach2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback, thisArg</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == <span class="hljs-literal">null</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;this is null or not defined&#x27;</span>)
	&#125;
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">&quot;function&quot;</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(callback + <span class="hljs-string">&#x27; is not a function&#x27;</span>)
	&#125;
	<span class="hljs-keyword">const</span> arr = <span class="hljs-built_in">Object</span>(<span class="hljs-built_in">this</span>)  <span class="hljs-comment">// this 就是当前的数组</span>
	<span class="hljs-keyword">const</span> len = arr.length &gt;&gt;&gt; <span class="hljs-number">0</span>  <span class="hljs-comment">// 后面有解释(非number 转成 number 类型)</span>
	<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>
	<span class="hljs-keyword">while</span> (index &lt; len) &#123;
		<span class="hljs-keyword">if</span> (index <span class="hljs-keyword">in</span> arr) &#123;
			callback.call(thisArg, arr[index], index, arr);
		&#125;
		index++;
	&#125;
&#125;
<span class="hljs-comment">// O.length &gt;&gt;&gt; 0 是什么操作？就是无符号右移 0 位</span>
<span class="hljs-comment">/// 就是为了保证转换后的值为正整数。其实底层做了 2 层转换</span>
<span class="hljs-comment">// 第一是非 number 转成 number 类型</span>
<span class="hljs-comment">// 第二是将 number 转成 Uint32 类型。</span>
<span class="hljs-comment">// &gt;&gt;&gt; 1 : 无符号右移 1 位，意思是 除二取整</span></code></pre>

<h3 id="13-Array-filter"><a href="#13-Array-filter" class="headerlink" title="13 Array.filter"></a>13 Array.filter</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// var newArray = arr.filter(callback(element [,index [,array]])  [,thisArg])</span>
<span class="hljs-built_in">Array</span>.prototype.filter2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback, thisArg</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == <span class="hljs-literal">null</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;this is null or not defined&#x27;</span>)
	&#125;
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">&quot;function&quot;</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(callback + <span class="hljs-string">&#x27; is not a function&#x27;</span>)
	&#125;
	<span class="hljs-keyword">const</span> arr = <span class="hljs-built_in">Object</span>(<span class="hljs-built_in">this</span>)
	<span class="hljs-keyword">const</span> len = arr.length &gt;&gt;&gt; <span class="hljs-number">0</span>;
	<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">const</span> res = []
	<span class="hljs-keyword">while</span> (index &lt; len) &#123;
		<span class="hljs-keyword">if</span> (index <span class="hljs-keyword">in</span> arr) &#123;
			<span class="hljs-keyword">if</span> (callback.call(thisArg, arr[index], index, arr)) &#123;
				res.push(arr[index])                
			&#125;
		&#125;
		index++;
	&#125;
   <span class="hljs-keyword">return</span> res;
&#125;
</code></pre>

<h3 id="14-Array-some"><a href="#14-Array-some" class="headerlink" title="14 Array.some"></a>14 Array.some</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// arr.some(callback(element [,index [,array]]) [,thisArg])</span>
<span class="hljs-built_in">Array</span>.prototype.some2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback, thisArg</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == <span class="hljs-literal">null</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&#x27;this is null or not defined&#x27;</span>)
	&#125;
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">&quot;function&quot;</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(callback + <span class="hljs-string">&#x27; is not a function&#x27;</span>)
	&#125;
	<span class="hljs-keyword">const</span> O = <span class="hljs-built_in">Object</span>(<span class="hljs-built_in">this</span>)
	<span class="hljs-keyword">const</span> len = O.length &gt;&gt;&gt; <span class="hljs-number">0</span>
	<span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>
	<span class="hljs-keyword">while</span> (k &lt; len) &#123;
		<span class="hljs-keyword">if</span> (k <span class="hljs-keyword">in</span> O) &#123;
			<span class="hljs-keyword">if</span> (callback.call(thisArg, O[k], k, O)) &#123;
				<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
			&#125;
		&#125;
		k++;
	&#125;
   <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
&#125;</code></pre>

<h3 id="15-两数相加"><a href="#15-两数相加" class="headerlink" title="15 两数相加"></a>15 两数相加</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 考虑 正负数的情况</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preciseAdd</span>(<span class="hljs-params">str1, str2</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length !== <span class="hljs-number">2</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;arguments is error&#x27;</span>);
	&#125;
	<span class="hljs-keyword">let</span> res = <span class="hljs-string">&#x27;&#x27;</span>;
	<span class="hljs-keyword">let</span> s1 = str1.split(<span class="hljs-string">&#x27;&#x27;</span>);
	<span class="hljs-keyword">let</span> s2 = str2.split(<span class="hljs-string">&#x27;&#x27;</span>);
	<span class="hljs-keyword">if</span> ((str1.startsWith(<span class="hljs-string">&#x27;-&#x27;</span>) &amp;&amp; !str2.startsWith(<span class="hljs-string">&#x27;-&#x27;</span>)) || (!str1.startsWith(<span class="hljs-string">&#x27;-&#x27;</span>) &amp;&amp; str2.startsWith(<span class="hljs-string">&#x27;-&#x27;</span>))) &#123;
		<span class="hljs-comment">// 一正一负</span>
		<span class="hljs-keyword">const</span> str1LessZero = str1.startsWith(<span class="hljs-string">&#x27;-&#x27;</span>); <span class="hljs-comment">// 表示前面数字是负数，后面是正数</span>
		<span class="hljs-keyword">if</span> (str1LessZero) &#123;
			s1.shift();
		&#125; <span class="hljs-keyword">else</span> &#123;
			s2.shift();
		&#125;
		<span class="hljs-comment">// 判断两个数字大小</span>
		<span class="hljs-keyword">let</span> s1LagerS2 = s1.length &gt; s2.length;
		<span class="hljs-keyword">if</span> (s1.length === s2.length) &#123;
			<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; s1.length; i++) &#123;
				<span class="hljs-keyword">if</span>(s1[i] === s2[i]) <span class="hljs-keyword">continue</span>;
				s1LagerS2 = s1[i] &gt; s2[i];
				<span class="hljs-keyword">break</span>;
			&#125;
		&#125;
		<span class="hljs-comment">// 如果 s1 比 s2 小，则互换</span>
		<span class="hljs-keyword">if</span> (!s1LagerS2) &#123;
			<span class="hljs-comment">// s1 = [s2, s2 = s1][0] // 快速互换</span>
			<span class="hljs-keyword">const</span> tem = [...s1];
			s1 = [...s2];
			s2 = [...tem];
		&#125;
		<span class="hljs-keyword">while</span>(s1.length) &#123;
			<span class="hljs-keyword">const</span> val = ~~s1.pop() - ~~s2.pop();
			<span class="hljs-keyword">if</span> (val &gt;= <span class="hljs-number">0</span>) &#123;
				res = val + res;
			&#125; <span class="hljs-keyword">else</span> &#123;
				res = val + <span class="hljs-number">10</span> + res;
				<span class="hljs-comment">// 不够减，需要把前一个值减一</span>
				s1[s1.length - <span class="hljs-number">1</span>]--;
			&#125;
		&#125;
		res = res.replace(<span class="hljs-regexp">/^0*/g</span>, <span class="hljs-string">&#x27;&#x27;</span>); <span class="hljs-comment">// 去掉前面的无效0</span>
		<span class="hljs-comment">// (前正后负，前比后小) || (前负后正，前比后大)</span>
		res = (str1LessZero &amp;&amp; s1LagerS2) || (!str1LessZero &amp;&amp; !s1LagerS2) ? <span class="hljs-string">&#x27;-&#x27;</span> + res : res;
		<span class="hljs-comment">// 如果 两数相等，则 res = &#x27;&#x27;或者 res = &#x27;-&#x27;</span>
		<span class="hljs-keyword">if</span>(res === <span class="hljs-string">&#x27;-&#x27;</span> || !res) &#123;
			res = <span class="hljs-string">&#x27;0&#x27;</span>;
		&#125;
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-comment">// 两正数 或者 两负数</span>
		<span class="hljs-comment">// 两个负数</span>
		<span class="hljs-keyword">const</span> twoF = str1.startsWith(<span class="hljs-string">&#x27;-&#x27;</span>) &amp;&amp; str2.startsWith(<span class="hljs-string">&#x27;-&#x27;</span>);
		<span class="hljs-keyword">if</span> (twoF) &#123;
			s1.shift();
			s2.shift();
		&#125;
		<span class="hljs-keyword">let</span> carry = <span class="hljs-number">0</span>;
		<span class="hljs-keyword">while</span> (s1.length || s2.length || carry) &#123;
			<span class="hljs-keyword">const</span> val = ~~s1.pop() + ~~s2.pop() + carry;
			res = val % <span class="hljs-number">10</span> + res;
			carry = <span class="hljs-built_in">Math</span>.floor(val / <span class="hljs-number">10</span>);

		&#125;
		res = twoF ? <span class="hljs-string">&#x27;-&#x27;</span> + res : res;
	&#125;
	<span class="hljs-keyword">return</span> res;
&#125;

<span class="hljs-comment">// 简易版 只考虑正数</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preciseAdd</span>(<span class="hljs-params">str1, str2</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length !== <span class="hljs-number">2</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;arguments is error&#x27;</span>);
	&#125;
	<span class="hljs-keyword">const</span> arr1 = str1.split(<span class="hljs-string">&#x27;&#x27;</span>);
	<span class="hljs-keyword">const</span> arr2 = str2.split(<span class="hljs-string">&#x27;&#x27;</span>);
	<span class="hljs-keyword">let</span> res = <span class="hljs-string">&#x27;&#x27;</span>;
	<span class="hljs-keyword">let</span> carry = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span>(arr1.length || arr2.length || carry) &#123;
		<span class="hljs-keyword">const</span> val = ~~arr1.pop() + ~~arr2.pop() + carry;
		res = val % <span class="hljs-number">10</span> + res;
		carry = <span class="hljs-built_in">Math</span>.floor(val / <span class="hljs-number">10</span>);
	&#125;
	<span class="hljs-keyword">return</span> res;
&#125;</code></pre>

<h3 id="16-两数相减"><a href="#16-两数相减" class="headerlink" title="16 两数相减"></a>16 两数相减</h3><pre><code class="hljs javaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">minus</span>(<span class="hljs-params">a, b</span>) </span>&#123;
	<span class="hljs-keyword">let</span> res = <span class="hljs-string">&#x27;&#x27;</span>;

	<span class="hljs-keyword">let</span> arr1 = a.split(<span class="hljs-string">&#x27;&#x27;</span>);
	<span class="hljs-keyword">let</span> arr2 = b.split(<span class="hljs-string">&#x27;&#x27;</span>);

	<span class="hljs-comment">// 判断 a 和 b 的大小</span>
	<span class="hljs-keyword">let</span> aLagerB = arr1.length &gt; arr2.length;
	<span class="hljs-keyword">if</span> (arr1.length === arr2.length) &#123;
		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr1.length; i++) &#123;
			<span class="hljs-keyword">if</span>(arr1[i] === arr2[i]) &#123;
				<span class="hljs-keyword">continue</span>;
			&#125;
			aLagerB = arr1[i] &gt; arr2[i];
			<span class="hljs-keyword">break</span>;
		&#125;
	&#125;

	<span class="hljs-comment">// 如果 a 比 b 小，则互换位置</span>
	<span class="hljs-keyword">if</span> (!aLagerB) &#123;
		<span class="hljs-comment">// arr1 = [arr2, arr2 = arr1][0]</span>
		<span class="hljs-keyword">const</span> tem = arr1;
		arr1 = arr2;
		arr2 = tem;
	&#125;
	<span class="hljs-keyword">while</span> (arr1.length) &#123;
		<span class="hljs-keyword">const</span> val = ~~arr1.pop() - ~~arr2.pop();
		<span class="hljs-keyword">if</span> (val &gt;= <span class="hljs-number">0</span>) &#123;
			res = val + res;
		&#125; <span class="hljs-keyword">else</span> &#123;
			res = val + <span class="hljs-number">10</span> + res;
			arr1[arr1.length - <span class="hljs-number">1</span>]--;
		&#125;
	&#125;
	res = res.replace(<span class="hljs-regexp">/^0*/g</span>, <span class="hljs-string">&#x27;&#x27;</span>);
	res = !aLagerB ? <span class="hljs-string">&#x27;-&#x27;</span>  + res : res;
	<span class="hljs-comment">// 如果出现两数相等，则 res = &#x27;-&#x27;</span>
	res = res === <span class="hljs-string">&#x27;-&#x27;</span> ? <span class="hljs-string">&#x27;0&#x27;</span> : res;
	<span class="hljs-keyword">return</span> res;
&#125;</code></pre>

<h3 id="17-两数相乘"><a href="#17-两数相乘" class="headerlink" title="17 两数相乘"></a>17 两数相乘</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 普通乘法</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cheng</span>(<span class="hljs-params">str1, str2</span>) </span>&#123;
	<span class="hljs-keyword">let</span> res = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">const</span> s1 = ~~str1;
	<span class="hljs-keyword">const</span> s2 = ~~str2;
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; s2; i++) &#123;
		res += s1;
	&#125;
	<span class="hljs-keyword">return</span> res;
&#125;

<span class="hljs-comment">// 大数相乘 a b 都是字符串</span>
<span class="hljs-keyword">var</span> multiply = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">num1, num2</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (num1 === <span class="hljs-string">&#x27;0&#x27;</span> || num2 === <span class="hljs-string">&#x27;0&#x27;</span>) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;0&#x27;</span>;
	&#125;
	<span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(num1.length + num2.length).fill(<span class="hljs-number">0</span>);
	<span class="hljs-comment">// 得到乘积的数组</span>
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; num1.length; i++) &#123;
		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; num2.length; j++) &#123;
			arr[i + j + <span class="hljs-number">1</span>] += ~~num1[i] * ~~num2[j];
		&#125;
	&#125;
	<span class="hljs-comment">// 处理进位</span>
	<span class="hljs-keyword">let</span> i = arr.length - <span class="hljs-number">1</span>;
	<span class="hljs-keyword">while</span>(i &gt;= <span class="hljs-number">0</span>) &#123;
		<span class="hljs-keyword">const</span> carry = <span class="hljs-built_in">Math</span>.trunc(arr[i] / <span class="hljs-number">10</span>);
		<span class="hljs-keyword">if</span> (carry) &#123;
			arr[i - <span class="hljs-number">1</span>] += carry;
		&#125;
		arr[i] = arr[i] % <span class="hljs-number">10</span>;
		i--;
	&#125;
	<span class="hljs-comment">// 去掉前面多余的0</span>
	<span class="hljs-keyword">while</span>(arr[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span>) &#123;
		arr.shift();
	&#125;
	<span class="hljs-keyword">return</span> arr.join(<span class="hljs-string">&#x27;&#x27;</span>);
&#125;;</code></pre>

<h3 id="18-两数相除"><a href="#18-两数相除" class="headerlink" title="18 两数相除"></a>18 两数相除</h3><p>给定两个整数，被除数 dividend和除数divisor。将两数相除，要求不使用乘法、除法和 mod 运算符。<br>返回被除数 dividend 除以除数divisor 得到的商。</p>
<pre><code class="hljs javaScript"><span class="hljs-keyword">var</span> divide = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dividend, divisor</span>) </span>&#123;
	<span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">const</span> flag = (dividend &gt; <span class="hljs-number">0</span> &amp;&amp; divisor &gt; <span class="hljs-number">0</span>) || (dividend &lt; <span class="hljs-number">0</span> &amp;&amp; divisor &lt; <span class="hljs-number">0</span>);
	<span class="hljs-keyword">let</span> mul = <span class="hljs-number">1</span>;

	<span class="hljs-keyword">let</span> s1 = <span class="hljs-built_in">Math</span>.abs(dividend);
	<span class="hljs-keyword">let</span> s2 = <span class="hljs-built_in">Math</span>.abs(divisor);
	<span class="hljs-keyword">let</span> s3 = s2;

	<span class="hljs-keyword">while</span> (s1 &gt;= s3) &#123;
		<span class="hljs-keyword">if</span> (s1 &gt; (s3 + s3)) &#123;
			s3 += s3;
			mul += mul;
		&#125;
		s1 -= s3;
		result += mul;
	&#125;
	<span class="hljs-keyword">while</span> (s1 &gt;= s2) &#123;
		s1 -= s2;
		result += <span class="hljs-number">1</span>;
	&#125;

	<span class="hljs-keyword">if</span> (flag &amp;&amp; result &gt; (<span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, <span class="hljs-number">31</span>) - <span class="hljs-number">1</span>)) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, <span class="hljs-number">31</span>) - <span class="hljs-number">1</span>;
	&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!flag &amp;&amp; result &lt; -<span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, <span class="hljs-number">31</span>)) &#123;
		<span class="hljs-keyword">return</span> -<span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, <span class="hljs-number">31</span>);
	&#125;
	<span class="hljs-keyword">return</span> !flag ? -result : result;
&#125;;</code></pre>

<h3 id="19-Math-pow"><a href="#19-Math-pow" class="headerlink" title="19 Math.pow()"></a>19 Math.pow()</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// 解法一: 迭代</span>
<span class="hljs-comment">// res 变量的值由 奇次or偶次幂 决定，如果是奇次幂，res 值为 num，反之，为1</span>
<span class="hljs-comment">// res 最后乘上累乘后的 num，返回</span>
<span class="hljs-keyword">var</span> myPow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">num, power</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (power &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / num * myPow(<span class="hljs-number">1</span> / num, -(power + <span class="hljs-number">1</span>));
	<span class="hljs-keyword">if</span> (power === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
	<span class="hljs-keyword">if</span> (power === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> num;
	<span class="hljs-comment">// 以上分别为power小于0 等于0 等于1 的情况</span>
	<span class="hljs-keyword">let</span> res = <span class="hljs-number">1</span>
	<span class="hljs-keyword">while</span> (power &gt; <span class="hljs-number">1</span>) &#123; <span class="hljs-comment">// power大于1</span>
		<span class="hljs-keyword">if</span> (power % <span class="hljs-number">2</span> === <span class="hljs-number">1</span>) &#123;
			res = res * num;
			power--;
		&#125;
		num = num * num;
		power = power / <span class="hljs-number">2</span>;
	&#125;
	<span class="hljs-keyword">return</span> res * num;
&#125;;

<span class="hljs-comment">// 解法二: 递归</span>
<span class="hljs-comment">// 递归版似乎更好理解一些，奇次幂的话，幂次-1，转成偶次幂</span>
<span class="hljs-comment">// 只需要写好偶次幂下的调用就好：myPow(num * num, power / 2)</span>
<span class="hljs-keyword">var</span> myPow = <span class="hljs-function">(<span class="hljs-params">num, power</span>) =&gt;</span> &#123;
	<span class="hljs-keyword">if</span> (power &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / (num * myPow(num, -(power + <span class="hljs-number">1</span>)));
	<span class="hljs-keyword">if</span> (power === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
	<span class="hljs-keyword">if</span> (power === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> num;
	<span class="hljs-keyword">return</span> power % <span class="hljs-number">2</span> === <span class="hljs-number">1</span> ?
		num * myPow(num, power - <span class="hljs-number">1</span>) :
		myPow(num * num, power / <span class="hljs-number">2</span>);
&#125;</code></pre>

<h2 id="六-开放题"><a href="#六-开放题" class="headerlink" title="六 开放题"></a>六 开放题</h2><p>1 实现一个简单路由<br>2 手写时钟<br>3 手写红绿灯</p>
<h3 id="1-实现一个简单路由"><a href="#1-实现一个简单路由" class="headerlink" title="1 实现一个简单路由"></a>1 实现一个简单路由</h3><pre><code class="hljs javaScript"><span class="hljs-comment">// hash路由</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Route</span></span>&#123;
	<span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span>&#123;
		<span class="hljs-comment">// 路由存储对象</span>
		<span class="hljs-built_in">this</span>.routes = &#123;&#125;;
		<span class="hljs-comment">// 当前hash</span>
		<span class="hljs-built_in">this</span>.currentHash = <span class="hljs-string">&#x27;&#x27;</span>;
		<span class="hljs-comment">// 绑定this，避免监听时this指向改变</span>
		<span class="hljs-built_in">this</span>.freshRoute = <span class="hljs-built_in">this</span>.freshRoute.bind(<span class="hljs-built_in">this</span>);
		<span class="hljs-comment">// 监听</span>
		<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-built_in">this</span>.freshRoute, <span class="hljs-literal">false</span>);
		<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&#x27;hashchange&#x27;</span>, <span class="hljs-built_in">this</span>.freshRoute, <span class="hljs-literal">false</span>);
	&#125;
	<span class="hljs-comment">// 存储</span>
	storeRoute (path, cb) &#123;
		<span class="hljs-built_in">this</span>.routes[path] = cb || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;&#125;;
	&#125;
	<span class="hljs-comment">// 更新</span>
	freshRoute () &#123;
		<span class="hljs-built_in">this</span>.currentHash = location.hash.slice(<span class="hljs-number">1</span>) || <span class="hljs-string">&#x27;/&#x27;</span>;
		<span class="hljs-built_in">this</span>.routes[<span class="hljs-built_in">this</span>.currentHash]();
	&#125;
&#125;
</code></pre>

<h3 id="2-手写时钟"><a href="#2-手写时钟" class="headerlink" title="2 手写时钟"></a>2 手写时钟</h3><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
			*&#123;
				padding: 0;
				margin: 0;
			&#125;
			html, body &#123;
				height: 100%;
			&#125;
<span class="css">			<span class="hljs-selector-class">.warp</span>&#123;</span>
				width: 230px;
				height: 230px;
				margin: 50px auto;
			&#125;
<span class="css">			<span class="hljs-selector-class">.clock</span>&#123;</span>
				width: 200px;
				height: 200px;
				border-radius: 115px;
<span class="css">				<span class="hljs-selector-tag">border</span>: 15<span class="hljs-selector-tag">px</span> <span class="hljs-selector-tag">solid</span> <span class="hljs-selector-id">#ccc</span>;</span>
<span class="css">				<span class="hljs-selector-tag">background</span>: <span class="hljs-selector-id">#fff</span>;</span>
				position: relative;
			&#125;
<span class="css">			<span class="hljs-selector-class">.number</span> <span class="hljs-selector-tag">div</span>&#123;</span>
				position: absolute;
				width: 20px;
				height: 200px;
				left: 90px;
			&#125;
<span class="css">			<span class="hljs-selector-class">.number</span> <span class="hljs-selector-tag">span</span>&#123;</span>
				display: block;
				width: 20px;
				height: 20px;
				text-align: center;
			&#125;
<span class="css">			<span class="hljs-selector-class">.pointer</span>&#123;</span>
				position: absolute;
				bottom: 90px;
				transform-origin: 50% 90%;
				-webkit-transform-origin: 50% 90%;
			&#125;
<span class="css">			<span class="hljs-selector-class">.houre</span>&#123;</span>
				width: 4px;
				height: 60px;
				left: 100px;
<span class="css">				<span class="hljs-selector-tag">background</span>: <span class="hljs-selector-id">#000</span>;</span>
			&#125;
<span class="css">			<span class="hljs-selector-class">.minute</span>&#123;</span>
				width: 2px;
				height: 80px;
				left: 100px;
<span class="css">				<span class="hljs-selector-tag">background</span>: <span class="hljs-selector-id">#777</span>;</span>
			&#125;
<span class="css">			<span class="hljs-selector-class">.second</span>&#123;</span>
				width: 1px;
				height: 90px;
				left: 100px;
<span class="css">				<span class="hljs-selector-tag">background</span>: <span class="hljs-selector-id">#ff0000</span>;</span>
			&#125;
		<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>
<span class="javascript">			<span class="hljs-built_in">window</span>.onload = <span class="hljs-function">() =&gt;</span> &#123;</span>
<span class="javascript">				<span class="hljs-keyword">var</span> domNumber = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;number&quot;</span>);</span>
<span class="javascript">				<span class="hljs-keyword">var</span> domDiv = domNumber.getElementsByTagName(<span class="hljs-string">&quot;div&quot;</span>);</span>
<span class="javascript">				<span class="hljs-keyword">var</span> domSpan = domNumber.getElementsByTagName(<span class="hljs-string">&quot;span&quot;</span>);</span>
		
<span class="javascript">				<span class="hljs-comment">// 布局 =&gt; 让数字旋转到相应的位置并调整方向</span></span>
<span class="javascript">				<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; domDiv.length; i++)&#123;</span>
<span class="javascript">					domDiv[i].style.WebkitTransform=<span class="hljs-string">&quot;rotate(&quot;</span> + (i + <span class="hljs-number">1</span>) * <span class="hljs-number">30</span> + <span class="hljs-string">&quot;deg)&quot;</span>;</span>
				&#125;

<span class="javascript">				<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; domSpan.length; j++)&#123;</span>
<span class="javascript">					domSpan[j].style.WebkitTransform=<span class="hljs-string">&quot;rotate(&quot;</span>+ (j + <span class="hljs-number">1</span>) * -<span class="hljs-number">30</span> + <span class="hljs-string">&quot;deg)&quot;</span>;</span>
				&#125;
	
<span class="javascript">				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clockRun</span>(<span class="hljs-params"></span>)</span>&#123;</span>
<span class="javascript">					<span class="hljs-keyword">var</span> domHour = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;houre&quot;</span>);</span>
<span class="javascript">					<span class="hljs-keyword">var</span> domMinute = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;minute&quot;</span>);</span>
<span class="javascript">					<span class="hljs-keyword">var</span> domSecond = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;second&quot;</span>);</span>

<span class="javascript">					<span class="hljs-keyword">var</span> nowTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();</span>
<span class="javascript">					<span class="hljs-keyword">var</span> nowHour = nowTime.getHours();</span>
<span class="javascript">					<span class="hljs-keyword">var</span> nowMinute = nowTime.getMinutes();</span>
<span class="javascript">					<span class="hljs-keyword">var</span> nowSecond = nowTime.getSeconds();</span>

<span class="javascript">					<span class="hljs-comment">// 计算指针的角度，其中最重要的是在不满一小时或不满一分钟时，时针或分针应该转多少度</span></span>
<span class="javascript">					<span class="hljs-keyword">var</span> houreDeg = (nowMinute/<span class="hljs-number">60</span>) * <span class="hljs-number">30</span>; <span class="hljs-comment">// 每小时是30度(1h = 60min, 1h =&gt;  360°/12h = 30 °/h)</span></span>
<span class="javascript">					<span class="hljs-keyword">var</span> minuteDeg = (nowSecond/<span class="hljs-number">60</span>) * <span class="hljs-number">6</span>; <span class="hljs-comment">// 每分钟是6度(1min = 60sec, 1min =&gt; 360°/60min = 6 °/h)</span></span>

<span class="javascript">					domHour.style.WebkitTransform = <span class="hljs-string">&quot;rotate(&quot;</span> + (nowHour * <span class="hljs-number">30</span> + houreDeg) + <span class="hljs-string">&quot;deg)&quot;</span>;</span>
<span class="javascript">					domMinute.style.WebkitTransform = <span class="hljs-string">&quot;rotate(&quot;</span> + (nowMinute * <span class="hljs-number">6</span> + minuteDeg) + <span class="hljs-string">&quot;deg)&quot;</span>;</span>
<span class="javascript">					domSecond.style.WebkitTransform = <span class="hljs-string">&quot;rotate(&quot;</span> + (nowSecond * <span class="hljs-number">6</span>) + <span class="hljs-string">&quot;deg)&quot;</span>;</span>
				&#125;
				clockRun();
<span class="javascript">				<span class="hljs-built_in">setInterval</span>(clockRun, <span class="hljs-number">1000</span>);</span>
			&#125;
		<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;warp&quot;</span> &gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;clock&quot;</span> &gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;number&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>12<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;houre&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pointer houre&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;minute&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pointer minute&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;second&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pointer second&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>

<h3 id="3-手写红绿灯"><a href="#3-手写红绿灯" class="headerlink" title="3 手写红绿灯"></a>3 手写红绿灯</h3><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
<span class="css">			<span class="hljs-selector-class">.light-content</span> &#123;</span>
				width: 400px;
				height: 150px;
<span class="css">				<span class="hljs-selector-tag">border</span>: 1<span class="hljs-selector-tag">px</span> <span class="hljs-selector-tag">solid</span> <span class="hljs-selector-id">#666</span>;</span>
				border-radius: 20px;
<span class="css">				<span class="hljs-selector-tag">background</span>: <span class="hljs-selector-id">#f7f7f7</span>;</span>
				display: flex;
				justify-content: space-around;
				align-items: center;
			&#125;
<span class="css">			<span class="hljs-selector-id">#red-light</span>, <span class="hljs-selector-id">#yellow-light</span>, <span class="hljs-selector-id">#green-light</span> &#123;</span>
				width: 100px;
				height: 100px;
				border-radius: 50px;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 35px;
			&#125;
		<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>
<span class="javascript">			<span class="hljs-built_in">window</span>.onload = <span class="hljs-function">() =&gt;</span> &#123;</span>
<span class="javascript">				<span class="hljs-keyword">let</span> red = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;red-light&#x27;</span>);</span>
<span class="javascript">				<span class="hljs-keyword">let</span> yellow= <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;yellow-light&#x27;</span>);</span>
<span class="javascript">				<span class="hljs-keyword">let</span> green = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;green-light&#x27;</span>);</span>

<span class="javascript">				<span class="hljs-keyword">let</span> colorsChange = <span class="hljs-function">(<span class="hljs-params">color, duration</span>) =&gt;</span> &#123;</span>
<span class="javascript">					<span class="hljs-keyword">if</span>(color === <span class="hljs-string">&#x27;red&#x27;</span>) &#123;</span>
<span class="javascript">						<span class="hljs-comment">// 设置灯的颜色变化</span></span>
						red.style.background = color;
<span class="javascript">						green.style.background = <span class="hljs-string">&#x27;#E2DCDC&#x27;</span>;</span>
<span class="javascript">						yellow.style.background = <span class="hljs-string">&#x27;#E2DCDC&#x27;</span>;</span>
<span class="javascript">						<span class="hljs-comment">// 设置倒计时</span></span>
						green.innerText = 0;
						yellow.innerText = 0;
<span class="javascript">						<span class="hljs-keyword">let</span> timeOut = duration;</span>
						red.innerText = timeOut / 1000;
<span class="javascript">						<span class="hljs-keyword">let</span> times = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;</span>
							red.innerText = (timeOut - 1000) / 1000;
							timeOut -= 1000;
<span class="javascript">							<span class="hljs-keyword">if</span> (timeOut === <span class="hljs-number">0</span>) &#123;</span>
<span class="javascript">								<span class="hljs-built_in">clearInterval</span>(times);</span>
							&#125;
						&#125;, 1000);
					&#125;
<span class="javascript">					<span class="hljs-keyword">if</span>(color === <span class="hljs-string">&#x27;yellow&#x27;</span>) &#123;</span>
<span class="javascript">						<span class="hljs-comment">// 设置灯的颜色变化</span></span>
						yellow.style.background = color;
<span class="javascript">						green.style.background = <span class="hljs-string">&#x27;#E2DCDC&#x27;</span>;</span>
<span class="javascript">						red.style.background = <span class="hljs-string">&#x27;#E2DCDC&#x27;</span>;</span>
<span class="javascript">						<span class="hljs-comment">// 设置倒计时</span></span>
						red.innerText = 0;
						green.innerText = 0;
<span class="javascript">						<span class="hljs-keyword">let</span> timeOut = duration;</span>
						yellow.innerText = timeOut / 1000;
<span class="javascript">						<span class="hljs-keyword">let</span> times = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;</span>
							yellow.innerText = (timeOut - 1000) / 1000;
							timeOut -= 1000;
<span class="javascript">							<span class="hljs-keyword">if</span> (timeOut === <span class="hljs-number">0</span>) &#123;</span>
<span class="javascript">								<span class="hljs-built_in">clearInterval</span>(times);</span>
							&#125;
						&#125;, 1000);
					&#125;
<span class="javascript">					<span class="hljs-keyword">if</span>(color === <span class="hljs-string">&#x27;green&#x27;</span>) &#123;</span>
<span class="javascript">						<span class="hljs-comment">// 设置灯的颜色变化</span></span>
						green.style.background = color;
<span class="javascript">						red.style.background = <span class="hljs-string">&#x27;#E2DCDC&#x27;</span>;</span>
<span class="javascript">						yellow.style.background = <span class="hljs-string">&#x27;#E2DCDC&#x27;</span>;</span>
<span class="javascript">						<span class="hljs-comment">// 设置倒计时</span></span>
						yellow.innerText = 0;
						red.innerText = 0;
<span class="javascript">						<span class="hljs-keyword">let</span> timeOut = duration;</span>
						green.innerText = timeOut / 1000;
<span class="javascript">						<span class="hljs-keyword">let</span> times = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;</span>
							green.innerText = (timeOut - 1000) / 1000;
							timeOut -= 1000;
<span class="javascript">							<span class="hljs-keyword">if</span> (timeOut === <span class="hljs-number">0</span>) &#123;</span>
<span class="javascript">								<span class="hljs-built_in">clearInterval</span>(times);</span>
							&#125;
						&#125;, 1000);
					&#125;
				&#125;;

<span class="javascript">				<span class="hljs-keyword">let</span> setColor = <span class="hljs-function">(<span class="hljs-params">color, duration</span>) =&gt;</span> &#123;</span>
<span class="javascript">					<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">res,rej</span>) =&gt;</span> &#123;</span>
						colorsChange(color, duration);
<span class="javascript">						<span class="hljs-built_in">setTimeout</span>(res, duration);</span>
					&#125;)
				&#125;

<span class="javascript">				<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setLight</span>(<span class="hljs-params"></span>) </span>&#123;</span>
<span class="javascript">					<span class="hljs-keyword">await</span> setColor(<span class="hljs-string">&#x27;red&#x27;</span>, <span class="hljs-number">7000</span>);</span>
<span class="javascript">					<span class="hljs-keyword">await</span> setColor(<span class="hljs-string">&#x27;yellow&#x27;</span>, <span class="hljs-number">3000</span>);</span>
<span class="javascript">					<span class="hljs-keyword">await</span> setColor(<span class="hljs-string">&#x27;green&#x27;</span>, <span class="hljs-number">5000</span>);</span>
<span class="javascript">					<span class="hljs-keyword">await</span> setLight();</span>
				&#125;
				setLight();
			&#125;
		<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;light-content&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;red-light&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;yellow-light&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;green-light&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/interview/">interview</a>
                    
                      <a class="hover-with-bg" href="/tags/js/">js</a>
                    
                      <a class="hover-with-bg" href="/tags/%E6%89%8B%E5%86%99/">手写</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/01/19/interview/%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">js-优化方案</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/01/07/interview/React%E7%81%B5%E9%AD%8223%E9%97%AE/">
                        <span class="hidden-mobile">interView - React</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>





  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
